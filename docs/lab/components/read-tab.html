<!-- Read Tab Content -->
<div class="page-content">
    <div class="app-grid">
        <div id="st1-grid" class="app-cell app-cell--12">
            <h4>The ridehailing simulation model</h4>
            <p>
                Many current debates and discussions about Uber and other ridehail systems rely either on data provided by the ridehail companies themselves, or on broad qualitative claims. The goal of this simulation is to fit a gap in the middle. The simulation is quantitative, and can be calibrated against broad aggregate statistics, such as utilization rates for a city, which are more widely available than detailed statistical data. The simulation is intended to be as simple as possible while still capturing the essential elements of a ridehail system: vehicles and trips in a generic "city". It is a work in progress that, if it turns out well, may enable some of the following:
            </p>
            <ul>
                <li>
                    Some policy debates fall into talk at cross purposes, with different unstated assumptions underlying rival claims. I hope a computer simulation lets some of these assumptions be checked.
                </li>
                <li>
                    Driver income for gig economy companies such as Uber is related to passenger fares in a different way to "normal" pay for service. Simulation helps us to see how "minimum wage" proposals that do not cover time waiting for an assignment fail to address the problems that drivers face.
                </li>
                <li>
                    A simple model that is independent of a particular city geography and road layout is easier for comparisons of the ridehail experience among cities.
                </li>
                <li>
                    A computer simulation allows "what if?" experiments that may provide insights into the tradeoffs faced by platform companies, municipal governments, drivers and passengers.
                </li>
            </ul>
            <p>
                It is a work in progress. It is written in python and source code is available from
                <a href="https://github.com/tomslee/ridehail">GitHub.</a>
                It can be run either in the browser (here) or as a desktop application.
            </p>
            <h5>Configuration Files</h5>
            <p>
                You can now save and load your experiment configurations using the download and upload buttons in the toolbar. This enables seamless workflow between the web laboratory and desktop application.
            </p>
            <p>
                <strong>Download:</strong> Click the download button (↓) to save your current settings as a <code>.config</code> file. The file is compatible with the desktop application and includes all parameters: city size, vehicle count, pricing, equilibration settings, and more.
            </p>
            <p>
                <strong>Upload:</strong> Click the upload button (↑) to load a previously saved configuration file. The system will automatically:
            </p>
            <ul>
                <li>Detect the appropriate scale (Village, Town, or City) based on parameter values</li>
                <li>Adjust any out-of-range values to fit within the selected scale's constraints</li>
                <li>Show you a summary of the configuration and any adjustments before applying</li>
                <li>Update all controls and reset the simulation with the new settings</li>
            </ul>
            <p>
                <strong>Desktop Compatibility:</strong> Configuration files use the same INI format as the desktop application, enabling you to:
            </p>
            <ul>
                <li>Start experimenting in the browser, download your config, and continue on desktop for more extensive analysis</li>
                <li>Create configurations on desktop, upload to the web lab for quick visualization</li>
                <li>Share configurations with collaborators across platforms</li>
            </ul>
            <p>
                <strong>Note on Scale Inference:</strong> The desktop application doesn't have the Village/Town/City scale concept - it accepts any valid parameter values. When you upload a desktop config file, the web lab automatically selects the smallest scale that can accommodate all parameter values. If some values exceed the maximum for that scale, they will be adjusted (clamped) and you'll see a warning in the confirmation dialog.
            </p>
            <p>
                The ridehail simulation has three components:
                <ul>
                    <li>
                        A geographical area. This is called a City, as most discussions about ridehail systems have focused on cities as the unit of comparison, but it need not be an actual "city".
                    </li>
                    <li>
                        Vehicles. These drive around the city, respond to trip requests, and carry passengers from the trip origin to the trip destination.
                    </li>
                    <li>
                        Trips. These start as trip requests, and have an origin and destination within the city.
                    </li>
                </ul>
            </p>
            <h5>The city</h5>
            <p>
                A city is represented as simply as possible: it is a square of uniformly-sized blocks, with C blocks on each side of the square. The square is, however, "wrapped", so that a vehicle going off the top of the city appears at the bottom, and a vehicle going off the right of the city appears on the left. This is not as unrealistic as it may first appear: in the real world, drivers are not bound by city boundaries: some trips will go outside the city and some will come from outside in, so the City can be thought of as an area with vehicles leaving and entering. In this uniform city, all locations are identical. A city with distinct zones is also allowed, and is described below.
            </p>
            <p>
                A single block is the unit of travel, and may be thought of as a distance or a time of travel, or a combination of the two. In practice it is often taken as a minute of travel time, but this is not a requirement.
            </p>
            <h5>Vehicles</h5>
            <p>
                Vehicles all drive at the same speed, and are always in one of three "phases", which are commonly used in discussions of ridehail systems.
            </p>
            <p>
                In "P1" they are available to be assigned for trips, but do not have an assigned trip. In this phase they drive randomly around the city. Vehicles in P1 are also sometimes called "idle".
            </p>
            <p>
                In "P2" a vehicle is assigned to a trip, and drives towards the trip origin by the shortest route to pick up the passenger. This route may involve going "off the edge" of the city and appearing at the opposite side. P2 is sometimes called "en route" to picking up the passenger.
            </p>
            <p>
                In "P3", a vehicle has a passenger and is driving by the shortest route to the destination. Evaluated across the whole driver population, the proportion of time drivers spend in P3 is also the utilization rate for the system. Once the trip is complete, the vehicle returns to P1.
            </p>
            <h5>Trips</h5>
            <p>
                A trip has an origin and a destination. In the simplest simulation, each is chosen randomly from intersections in the city, except that the two locations cannot be the same.
            </p>
            <p>
                Each vehicle can take only one trip at a time. This can be thought of as one passenger or a group of passengers, but it does not include "shared trips" such as the "Uber Pool" service where (groups of) passengers request trips separately but share a vehicle for some portion of the trip. RIdehail operators have repeatedly tried to introduce such systems but, even before Covid, such shared trips made up a small portion of the total trips, and even when a passenger requested an "Uber Pool" trip they often end up not sharing the vehicle. The simulation focuses entirely on "UberX-like" systems.
            </p>
            <p>
                Trip time is in one of two phases: waiting or traveling. For randomly-selected trip origns and destinations, the average trip length in a city with C blocks along each side is C/2.
            </p>
            <p>
                The "wait time" here, between placing a trip request and the arrival of the vehicle does not exactly match that commonly used by Uber. For Uber, the wait time is the time until the driver appears at the location, but that leaves an unassigned period between arrival and the start of the trip, which may include time for the passenger to come out onto the street, find the vehicle (or for the driver to pick out the passenger), and get in the vehicle.
            </p>
            <h5>The simulation</h5>
            <p>
                Each simulation is a sequence of moves, in each of which vehicles travel one block. A typical move involves the following events:
            </p>
            <ol>
                <li>
                    Any new trip requests are generated and made.
                </li>
                <li>
                    Available vehicles are assigned to trips. The trip is assigned to the nearest available vehicle in P1, and if there are multiple vehicles at the same distance from the trip origin, one is selected at random. Vehicles always accept trip assignments.
                </li>
                <li>
                    Vehicles move from one intersection to the next. For each vehicle, this involves choosing a direction and moving a block to the next intersection. For vehicles in P1, the direction is random; for vehicles in P2 and P3, the direction is towards the trip origin or destination, as applicable.
                </li>
                <li>
                    Any trip that reaches its destination terminates.
                </li>
            </ol>
            <p>
                At the end of each move, the simulation records and optionally plots the state of each vehicle and statistics about the overall system (fraction of vehicles in each phase, for example).
            </p>
            <p>
                The simulation is implemented in the Python programming language, and the code is available on GitHub. It can be run as a desktop application from a command line or at a web site.
            </p>
            <p>
                The desktop application is controlled by a configuration file, which at its simplest specifies the size of the city (number of blocks on each side), the base demand rate (number of trip requests each move), and the number of vehicles.
            </p>
            <p>
                The simulation is also available at a web site, where the configuration is set in the browser. The simulation runs in the browser (not at a server), using the Pyodide python distribution, and is the same code as the desktop. The web site is currently a "laboratory, which allows experimentation but does not provide a way to save results. All results in this report are taken from desktop simulations.
            </p>
            <h5>Entry and exit</h5>
            <p>
                The description so far could apply to any taxi-like system. An element of the gig-economy ridehail business model is that drivers can enter and exit at any time, by signing into the application or turning it off. The simulation captures entry and exit of drivers as follows.
            </p>
            <p>
                Each trip is assigned a price per block p, with the ridehail platform taking a fraction of that price as a commission (m). Driver gross income before expenses is therefore
                <pre>I = p<sub>3</sub> . p . (1 – m)</pre>
            </p>
            <p>
                Drivers also have costs. These include fixed costs, marginal cost of operations (fuel, insurance, maintenance, cleaning, etc.) and "opportunity costs" co, which is the value of other things they could be doing at the same time. The opportunity costs can also be considered as the reservation wage (cw): the after-expenses income a driver must make for driving to be worth their while.
            </p>
            <p>
                Phrased another way, the "driver utility" U is
                <pre>U = p<sub>3</sub>. p . (1 – m) – c<sub>o</sub> - c<sub>w</sub></pre>
            </p>
            <p>
                Periodically, a simulation with equilibration enabled computes the average driver utility for the system as a whole based on the entered price, commission, and costs (which all stay constant for a simulation), and also on the observed utilization rate p3. If U is greater than zero (income after expenses is greater than the reservation wage) then there is money to be made by drivers, and more vehicles enter the system. If U is less than zero, then for some drivers it is not worth their time to be driving and they leave the system. Over time, the system equilibrates to a steady state.
            </p>
            <h5>Mapping to cities</h5>
            <p>
                While the simulation is carried out entirely in abstract units of blocks, and currency-free prices and costs, the configuration also allows these to be derived from less abstract quantities. If a "real-world" option is chosen, the configuration can separately enter prices per km and per minute; driver costs can be assigned per km (operational costs) and per minute (opportunity costs), and an average speed connects the relationship between space and time so that a "block" has an assigned time and distance. These values are translated into the abstract prices and costs per block.
            </p>
            <h5>Extensions</h5>
            <p>
                Several additional refinements have been implemented, but the spirit of the simulation is to be as simple as possible, so that it can be calibrated using the very limited high-level public data available and so that it can be used comparatively. However, two are necessary for some applications below.
            </p>
            <p>
                Many cities have a central "downtown" zone where the demand for ridehail traffic is high, surrounded by suburban areas where demand is lower. This inhomogeneity is built into the model as two zones. A central zone has sides C/2 (so, one quarter of the city's area) and has a higher rate of trip requests than the surrounding area. The trip destinations remain randomly distributed around the whole city. With an inhomogeneity of zero, the central zone is the same as the rest, with an inhomogeneity of one all trip requests take place in the central zone. In this way, and in the sprit of keeping the model as simple and parsimonious as possible, a single inhomogeneity parameter between zero and one captures the two zones.
            </p>
            <p>
                The use of random locations for trip destinations implies an average trip length of C/2 (regardless of inhomogeneity). To model an area where the average trip length may differ from this, a maximum trip length can be set, with trips distributed randomly over intersections within that distance. This maximum trip length is mentioned below.
            </p>
            <h4>Contact</h4>
            <p>
                Email:
                <a href="mailto:tom@tomslee.net?subject=Ridehail simulation">tom@tomslee.net</a>
            </p>
            <h4>Acknowledgements</h4>
            <p>
                The project was inspired in part by this
                <a href="https://www.nytimes.com/interactive/2017/04/02/technology/uber-drivers-psychological-tricks.html">2017 New York Times interactive visualization</a>
                (scroll down that page a bit).
            </p>
            <p>
                The calculations run in the browser using the amazing
                <a href="https://pyodide.org">Pyodide</a>
                distribution, although you can also run it on a Linux or Windows desktop if you are OK with setting up and running python packages. It should run on a Mac too, but I have not verified that.
            </p>
            <p>
                The site design is inspired by the impressive
                <a href="https://playground.tensorflow.org/">TensorFlow Playground,</a>
                and uses
                <a href="https://material.io/design">Material Design 3</a>
                for components and layout.
            </p>
            <p>
                Thanks also to Thorben and JJ from
                <a href="https://ridefair.ca/">The RideFairTO Coalition,</a>
                for encouragement, conversations, guidance, and contacts.
            </p>
            <p>
                Errors and other flaws are all mine.
            </p>
            <div style="display:none">
                <h4>Ridehailing</h4>
                <p>
                    Start with a community, which is a square grid with a number of "blocks" on each side.
                </p>
                <p>
                    A vehicle drives randomly around the community. If it goes off one edge, it appears on the opposite edge. This turns out to be a useful simplification. You can also think of it as some vehicles leaving the area, and others entering.
                </p>
                <div class="button-and-chart">
                    <table>
                        <tr>
                            <td>
                                <div class="st-button-parent">
                                    <button id="st1-button" class="app-button app-button--mini-fab">
                                        <i class="material-icons">play_arrow</i>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div id="st1-chart-parent" class="st-canvas-parent">
                                    <canvas id="st1-chart-canvas" class="st-chart-canvas"></canvas>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div>
                    <p>
                        In addition to vehicles, we need trips. Here is a vehicle driving around, and occasionally picking up a passenger for a trip.
                    </p>
                    <div>
                        <p>
                            The vehicle can be in three "phases".
                            <ul>
                                <li>
                                    P1: it does not have a trip assigned, and is available. Sometimes this is called 'idle'. It is shown in blue.
                                </li>
                                <li>
                                    P2: 'en route' to pick up a passenger. It is shown in an 'amber' colour.
                                </li>
                                <li>
                                    P3: busy. The vehicle has a passenger
                                </li>
                            </ul>
                        </p>
                        <p>
                            The trip origin is marked by a red diamond, and the trip destination (which shows up once the vehicle has picked up the passenger) is shown as a green circle (think of it as a target).
                        </p>
                        <p>
                            When the red diamond is shown, the passenger is in a "waiting" state. When the red circle is shown, the passenger is in the vehicle.
                        </p>
                    </div>
                    <div class="button-and-chart">
                        <table>
                            <tr>
                                <td>
                                    <div class="st-button-parent">
                                        <button id="st2-button" class="app-button app-button--mini-fab">
                                            <i class="material-icons">play_arrow</i>
                                        </button>
                                    </div>
                                </td>
                                <td>
                                    <div id="st2-chart-parent" class="st-canvas-parent">
                                        <canvas id="st2-chart-canvas" class="st-chart-canvas"></canvas>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <p></p>
            <p></p>
        </div>
    </div>
</div>
