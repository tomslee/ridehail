<!DOCTYPE html>
<html lang="zh-CN">
<head lang="en">
    <meta charset="utf-8">
    <title>Ridehail Laboratory</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=1024">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500|Material+Icons" rel="stylesheet">
    <!--  Material Design: se https://getmdl.io/started/index.html -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- theme from https://getmdl.io/customize/index.html -->
    <!--
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.green-deep_purple.min.css">
    -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-deep_orange.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js" integrity="sha256-RgW6ICRcHgz1vaGkL5egQAqmkWxGbwa2E3Boz/3CapM=" crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script> -->
    <!-- rendering on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>
<body>
    <!-- Always shows a header, even in smaller screens. -->
    <div class="mdl-layout mdl-js-layout">
        <header class="mdl-layout__header  mdl-layout__header--scroll ui-zoom-hide">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title">Ridehail Laboratory v0.1d (2022-04-02)</span>
                <!-- Add spacer, to align navigation to the right -->
                <div class="mdl-layout-spacer"></div>
                <!-- Navigation. We hide it in small screens. -->
                <nav class="mdl-navigation mdl-layout--large-screen-only">
                    <a class="mdl-navigation__link" href="https://github.com/tomslee/ridehail-animation">GitHub</a>
                    <a class="mdl-navigation__link" href="https://github.com/tomslee/ridehail-animation/blob/dev/LICENSE">License</a>
                </nav>
            </div>
            <!-- Tabs -->
            <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
                <a href="#scroll-tab-1" id="tab-experiment" class="mdl-layout__tab is-active">Experiment</a>
                <a href="#scroll-tab-what-if" id="tab-what-if" class="mdl-layout__tab">What if?</a>
                <a href="#scroll-tab-read" id="tab-read" class="mdl-layout__tab">Read</a>
                <a href="#scroll-tab-TO" id="tab-TO" class="mdl-layout__tab">Ridehail in Toronto</a>
            </div>
        </header>
        <main class="mdl-layout__content">
            <section class="mdl-layout__tab-panel is-active" id="scroll-tab-1">
                <!-- this section is the "Experiment" tab -->
                <div class="page-content">
                    <!-- lab / experiment content -->
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col">
                            <!-- top controls -->
                            <div id="top-controls" class="top-controls">
                                <div class="timeline-controls top-control">
                                    <button class="mdl-button mdl-js-button mdl-button--icon ui-resetButton" id="reset-button" title="Reset the ridehail system" disabled>
                                        <i class="material-icons">replay</i>
                                    </button>
                                    <button id="fab-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored" title="Run/Pause" disabled>
                                        <i class="material-icons">play_arrow</i>
                                    </button>
                                    <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="next-step-button" title="Step" disabled>
                                        <i class="material-icons">skip_next</i>
                                    </button>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Frame
                                    </div>
                                    <div class="value" id="frame-count">
                                        0
                                    </div>
                                </div>
                                <div id="top-control-spinner" class="top-control">
                                    <!--  MDL spinner -->
                                    <div id="spinner" class="mdl-spinner mdl-js-spinner is-active"></div>
                                    <p>
                                        Loading the ridehail simulator...
                                    </p>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Scale
                                    </div>
                                    <div>
                                        <label for="radio-community-village" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-village" name="scale" value="village" class="mdl-radio__button" checked>
                                            <span class="label mdl-radio__label">Village</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-community-town" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-town" name="scale" value="town" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Town</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-community-city" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-city" name="scale" value="city" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">City</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Chart type
                                    </div>
                                    <div>
                                        <label for="radio-chart-type-map" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-chart-type-map" class="mdl-radio__button" name="chart-type" value="map" checked>
                                            <span class="mdl-radio__label">Map</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-chart-type-stats" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-chart-type-stats" class="mdl-radio__button" name="chart-type" value="stats">
                                            <span class="mdl-radio__label">Statistics</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Mode
                                    </div>
                                    <div>
                                        <label for="radio-ui-mode-simple" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-ui-mode-simple" name="ui-mode" value="simple" class="mdl-radio__button" checked>
                                            <span class="label mdl-radio__label">Simple Model</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-ui-mode-advanced" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-ui-mode-advanced" name="ui-mode" value="advanced" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Costs &amp; Incomes</span>
                                        </label>
                                    </div>
                                </div>
                                <div id="file-drop-target" class="top-control" hidden>
                                    <div>
                                        Drop a file
                                    </div>
                                </div>
                            </div>
                            <!-- end of top-controls -->
                        </div>
                        <div id="column-1" class="mdl-cell mdl-cell--4-col ui-zoom-hide">
                            <!-- text column -->
                            <div class="ui-mode-simple">
                                <h5>Start here</h5>
                                <p>
                                    When the simulator has loaded, click the big orange button.
                                </p>
                                <p>
                                    The map shows a model city as a square of blocks. Ridehail vehicles (shown as triangles) drive the streets, waiting to be assigned a trip. When a passenger requests a trip (red diamond), it is assigned to a vehicle, which takes them to their destination (red circle).
                                </p>
                                <p>
                                    Choose a community
                                    <b>scale</b>
                                    of village, town, or city to set up different starting points. Press "z" on your keyboard to zoom in on the map, and again to zoom back out. Press "p" to pause and to resume.
                                </p>
                                <p>
                                    Choose a
                                    <b>chart type</b>
                                    of "Statistics" to show wait times, how driver time is split between different activities, and driver income (before and after expenses). If the
                                    <b>Mode</b>
                                    is set to "Simple Model" then these are not real-world numbers, they are just calculated per-block. If you set the Mode to "Costs &amp; Incomes" you can set some actual prices and costs.
                                </p>
                                <p>
                                    The behaviour and outcomes of these simulations depend on many factors. Experiment with changing the size of the community, the number of vehicles, and the rate of requests. If you check "Free entry &amp; exit" then drivers will become active if there is money to be made, and leave it if there is not. Choose "Advanced" to set prices and costs. How do wait times, driver "busy" times, and incomes change with the ridehail environment?
                                </p>
                                <p>
                                    For more information, click
                                    <b>Read</b>
                                    in the coloured title bar (under construction!). If things go wrong, press the "reset" button at the top left.
                                </p>
                            </div>
                            <div class="ui-mode-advanced">
                                <h5>Time, distance, and money</h5>
                                <p>
                                    You have chosen the "Costs &amp; Incomes" mode, which lets you link the model to more real-world values. In this mode, each block represents a minute of travel time. At an average speed of 30 km/h (which is realistic, as it includes all stopping times and pickup times) each block is 0.5km. You can set the following monetary parameters:
                                </p>
                                <ul>
                                    <li>
                                        "Per km" fare component. In Toronto this is roughly $0.80 for UberX.
                                    </li>
                                    <li>
                                        "Per minute" fare component. In Toronto this is roughly $0.20 for UberX.
                                    </li>
                                </ul>
                                <p>
                                    At an average speed of 30 km/h, these two values produce a fare of $0.60 per minute (per block, in this model). In addition to these components, UberX fares include a fixed "booking fee". As this is not passed on to the driver, it has no effect on driver income and is ignored here, for now.
                                </p>
                                <ul>
                                    <li>
                                        "Vehicle operating cost per km". One estimate of this would be $0.50/km, which is the lower end of the
                                        <a href="https://www.canada.ca/en/revenue-agency/services/tax/businesses/topics/payroll/benefits-allowances/automobile/automobile-motor-vehicle-allowances/reasonable-kilometre-allowance.html">Revenue Canada "reasonable allowance rates"</a>
                                        for reimbursement of employee use of a vehicle for business purposes. However, the model does not currently allow for the fact that drivers drive more slowly (or park) while in P1 phase (waiting for a ride). A $0.30/km estimate may be more reasonable until the slower driving in P1 is included.
                                    </li>
                                    <li>
                                        "Vehicle opportunity cost per hour". This is the money, after all expenses, that a driver would need to make in order to work.
                                    </li>
                                </ul>
                                <p>
                                    Adding these together gives the "reservation wage".
                                </p>
                            </div>
                        </div>
                        <div id="column-2" class="mdl-cell mdl-cell--2-col">
                            <!-- input settings -->
                            <h5>Ridehail environment</h5>
                            <div class="ui-ridehail-settings ui-mode-reset">
                                <label for="input-city-size">
                                    Area:
                                    <span class="value" id="option-city-size">8</span>
                                    blocks on each side
                                </label>
                                <p class="ui-zoom-hide">
                                    Think of each block as the distance a vehicle drives in one minute.
                                </p>
                                <input id="input-city-size" class="mdl-slider
                                mdl-js-slider" type="range" min="4" max="16" value="8" step="2">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced">
                                <label class="mld-inputfield__label" for="input-two-zone">
                                    Two zones: how much should the central zone be favoured?
                                    <span class="value" id="option-two-zone">0</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    When zero, trip requests are distributed evenly across the area. When set to 1, all requests are made in a central zone. Trips always terminate evenly across the area.
                                </p>
                                <input id="input-two-zone" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1" value="0.0" step="0.1">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                <label for="input-max-trip-distance">
                                    Maximum trip length:
                                    <span class="value" id="option-max-trip-distance">8</span>
                                    min
                                </label>
                                <p class="ui-zoom-hide">
                                    Trip destinations are randomly placed in a rectangle of at most this distance (in blocks) from the origin
                                </p>
                                <input id="input-max-trip-distance" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="8" value="8" step="1">
                            </div>
                            <h5>Vehicles</h5>
                            <div class="ui-ridehail-settings">
                                <label for="input-vehicle-count">
                                    Ridehail vehicles:
                                    <span class="value" id="option-vehicle-count">8</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The total number of active ridehail vehicles in the area. If you check "Free entry &amp; exit" the actual number will change during the simulation.
                                </p>
                                <input id="input-vehicle-count" class="mdl-slider mdl-js-slider" type="range" min="1" max="16" value="8" step="1">
                            </div>
                            <div class="ui-ridehail-settings">
                                <label class="mld-inputfield__label" for="input-request-rate">
                                    Trip requests:
                                    <span class="value" id="option-request-rate">0.5</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The number of requests in the time it takes a vehicle to travel one block. If you check "Free entry &amp; exit" and set an elasticity to something other than zero, the actual request rate will change during the simulation.
                                </p>
                                <input id="input-request-rate" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="4" value="0.5" step="0.1">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                <label for="input-mean-vehicle-speed">
                                    Mean vehicle speed:
                                    <span class="value" id="option-mean-vehicle-speed">30</span>
                                    km/h
                                </label>
                                <p class="ui-zoom-hide">
                                    The overall average traffic speed, including all stops and pickups.
                                </p>
                                <input id="input-mean-vehicle-speed" class="mdl-slider
                                mdl-js-slider" type="range" min="10" max="50" value="30" step="5">
                            </div>
                            <h5>Entry and exit</h5>
                            <div class="ui-ridehail-settings">
                                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-equilibrate">
                                    <input type="checkbox" id="checkbox-equilibrate" class="mdl-checkbox__input">
                                    <span class="mdl-checkbox__label">Free entry &amp; exit</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    Vehicles enter when there is money to be made above the "reservation wage", and leave when they cannot make money.
                                </p>
                            </div>
                            <h5>Fares</h5>
                            <div class="ui-ridehail-settings ui-mode-simple ui-mode-reset">
                                <label for="input-price">
                                    Fare:
                                    <span class="value" id="option-price">1.20</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The price per block.
                                </p>
                                <input id="input-price" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="4.0" value="1.2" step="0.1">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                <label for="input-per-km-price">
                                    "Per km" fare component: $
                                    <span class="value" id="option-per-km-price">0.80</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The distance component of the fare. The total fare is built from distance and time components.
                                </p>
                                <input id="input-per-km-price" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1.20" value="0.80" step="0.1">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                <label for="input-per-minute-price">
                                    "Per minute" fare component: $
                                    <span class="value" id="option-per-minute-price">0.20</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The time component of the fare. The total fare is built from distance and time components.
                                </p>
                                <input id="input-per-minute-price" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="0.40" value="0.20" step="0.05">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-equilibrate">
                                <label for="input-demand-elasticity">
                                    Demand elasticity
                                    <span class="value" id="option-demand-elasticity">0</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    How the request rate responds to price changes. If set to 0 the rate of requests does not change. Larger values make the demand fall more as the price rises.
                                </p>
                                <input id="input-demand-elasticity" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="2.00" value="0.00" step="0.1">
                            </div>
                            <h5 class="ui-mode-advanced">Platform income</h5>
                            <div class="ui-ridehail-settings">
                                <label for="input-platform-commission">
                                    Platform commission:
                                    <span class="value" id="option-platform-commission">0.25</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The fraction of the fare that the ridehailing platform takes. It passes the rest to the driver.
                                </p>
                                <input id="input-platform-commission" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="0.5" value="0.25" step="0.01">
                            </div>
                            <h5>Driver income</h5>
                            <div class="ui-ridehail-settings ui-mode-simple ui-mode-reset">
                                <label for="input-reservation-wage">
                                    Reservation wage
                                    <span class="value" id="option-reservation-wage">0.35</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The income per block above which it is worth driving.
                                </p>
                                <input id="input-reservation-wage" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1" value="0.35" step="0.05">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                <label for="input-per-km-ops-cost">
                                    Vehicle operations cost per km: $
                                    <span class="value" id="option-per-km-ops-cost">0.25</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    The cost to the driver of running their vehicle, per kilometer.
                                </p>
                                <input id="input-per-km-ops-cost" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1" value="0.25" step="0.05">
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset ui-mode-equilibrate">
                                <label for="input-per-hour-opportunity-cost">
                                    Vehicle opportunity cost per hour: $
                                    <span class="value" id="option-per-hour-opportunity-cost">10</span>
                                </label>
                                <p class="ui-zoom-hide">
                                    If you choose "Free entry &amp; exit" then vehicles will enter if they can make at least this amount of money (after all deductions), and leave if they cannot.
                                </p>
                                <input id="input-per-hour-opportunity-cost" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="30" value="10" step="1">
                            </div>
                            <h5>Display</h5>
                            <div class="ui-ridehail-settings ui-money-options ui-mode-reset ui-mode-advanced">
                                Statistics chart smoothing
                                <span id="option-smoothing-window">20</span>
                                frames
                                <p class="ui-zoom-hide">
                                    Statistics charts display a rolling average over this number of frames.
                                </p>
                                <input id="input-smoothing-window" class="mdl-slider mdl-js-slider" type="range" min="1" max="32" value="20" step="1">
                            </div>
                            <div class="ui-ridehail-settings ui-display-options">
                                Chart display maximum frame rate:
                                <span id="option-frame-timeout">300</span>
                                milliseconds
                                <p class="ui-zoom-hide">
                                    A small time speeds up the simulation.
                                </p>
                                <input id="input-frame-timeout" class="mdl-slider mdl-js-slider" type="range" min="0" max="1000" value="300" step="10">
                            </div>
                        </div>
                        <div id="chart-column" class="mdl-cell mdl-cell--6-col chart-column">
                            <!-- Map and statistics charts -->
                            <div class="pg-canvas-parent" hidden>
                                <canvas id="pg-city-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div class="pg-canvas-parent" hidden>
                                <canvas id="pg-phases-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div class="pg-canvas-parent" hidden>
                                <canvas id="pg-trip-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div class="pg-canvas-parent" hidden>
                                <canvas id="pg-income-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div class="pg-canvas-parent pg-map-canvas-parent">
                                <canvas id="pg-map-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div id="pg-stats-descriptions" class="pg-stats-descriptions">
                                <h5>Driver earnings key</h5>
                                <ul>
                                    <li>
                                        <b>On-the-clock:</b>
                                        hourly pay rate while drivers have a passenger in the car. The price rate the customer pays, minus the platform commission.
                                    </li>
                                    <li>
                                        <b>Gross:</b>
                                        actual hourly pay before any expenses. The "on-the-clock" pay, adjusted for the proportion of the time the driver has a passenger ("P3" time).
                                    </li>
                                    <li>
                                        <b>Net:</b>
                                        hourly income after operating expenses.
                                    </li>
                                    <li>
                                        <b>Surplus:</b>
                                        hourly income above the reservation wage. In the case of "Costs &amp; Incomes", the reservation wage is the sum of the operating expenses and the opportunity cost.
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mdl-layout__tab-panel" id="scroll-tab-what-if">
                <!-- this section is the "What if?" tab -->
                <div class="page-content">
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col">
                            <div id="what-if-top-controls" class="top-controls">
                                <div class="what-if-timeline-controls top-control">
                                    <div>
                                        Reset
                                    </div>
                                    <div>
                                        <button class="mdl-button mdl-js-button mdl-button--icon ui-resetButton" id="what-if-reset-button" title="Reset the ridehail system" disabled>
                                            <i class="material-icons">replay</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-timeline-controls top-control">
                                    <div>
                                        Choose baseline
                                    </div>
                                    <div>
                                        <label id="what-if-radio-baseline-preset-label" for="what-if-radio-baseline-preset" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="what-if-radio-baseline-preset" name="what-if-radio-baseline" class="mdl-radio__button" value="preset" checked>
                                            <span class="label mdl-radio__label">Preset</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label id="what-if-radio-baseline-lab-label" for="what-if-radio-baseline-lab" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="what-if-radio-baseline-lab" name="what-if-radio-baseline" value="lab" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">'Experiment' tab</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="what-if-timeline-controls top-control">
                                    <div>
                                        Run baseline
                                    </div>
                                    <div>
                                        <button id="what-if-fab-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored" title="Run/Pause">
                                            <i class="material-icons">play_arrow</i>
                                        </button>
                                        <!--
                                        <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="what-if-next-step-button" title="Step">
                                            <i class="material-icons">skip_next</i>
                                        </button>
                                        -->
                                    </div>
                                </div>
                                <div class="what-if-timeline-controls top-control">
                                    <div>
                                        Run comparison
                                    </div>
                                    <div>
                                        <!-- Colored mini FAB button -->
                                        <button id="what-if-comparison-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored" disabled>
                                            <i class="material-icons">play_arrow</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-timeline-controls top-control">
                                    <div>
                                        Frame
                                    </div>
                                    <div class="value" id="what-if-frame-count">
                                        0
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div>
                                        Price (/minute)
                                    </div>
                                    <div>
                                        <button id="what-if-price-remove" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">remove_circle</i>
                                        </button>
                                        <span id="what-if-price" class="what-if-comparison-value"></span>
                                        <button id="what-if-price-add" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">add_circle</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div>
                                        Platform commission
                                    </div>
                                    <div>
                                        <button id="what-if-commission-remove" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">remove_circle</i>
                                        </button>
                                        <span id="what-if-commission" class="what-if-comparison-value"></span>
                                        <button id="what-if-commission-add" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">add_circle</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control" hidden>
                                    <div>
                                        Vehicle cap
                                    </div>
                                    <div>
                                        <button id="what-if-cap-remove" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">remove_circle</i>
                                        </button>
                                        <span id="what-if-cap" class="what-if-comparison-value"></span>
                                        <button id="what-if-cap-add" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">add_circle</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div>
                                        Reservation wage (/hour)
                                    </div>
                                    <div>
                                        <button id="what-if-reservation-wage-remove" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">remove_circle</i>
                                        </button>
                                        <span id="what-if-reservation-wage" class="what-if-comparison-value"></span>
                                        <button id="what-if-reservation-wage-add" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">add_circle</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div>
                                        Demand (trips/hour)
                                    </div>
                                    <div>
                                        <button id="what-if-demand-remove" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">remove_circle</i>
                                        </button>
                                        <span id="what-if-demand" class="what-if-comparison-value"></span>
                                        <button id="what-if-demand-add" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">add_circle</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control" hidden>
                                    <div>
                                        Demand elasticity
                                    </div>
                                    <div>
                                        <button id="what-if-demand-elasticity-remove" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">remove_circle</i>
                                        </button>
                                        <span id="what-if-demand-elasticity" class="what-if-comparison-value"></span>
                                        <button id="what-if-demand-elasticity-add" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">
                                            <i class="material-icons">add_circle</i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="what-if-column-1" class="mdl-cell mdl-cell--4-col ui-zoom-hide">
                            <!-- descriptive text column on the left -->
                            <div class="mdl-cell mdl-cell--12-col">
                                <p>
                                    Click the orange button to run a baseline simulation. The charts show a ridehail environment in a small city of 24 by 24 blocks (each block is a minute of driving) with 480 ride requests per hour. The city has a downtown area of 12 by 12 blocks, where a large number of trip requests are made.
                                </p>
                                <p>
                                    The price is $0.80/km plus $0.20 per minute. With an average speed of 30 km/h this is an overall rate of $0.60 per minute. The platform takes a 25% commission, leaving $0.45 per on-the-clock minute for drivers ($27/hour).
                                </p>
                                <p>
                                    The charts show the driver phases, measurements of drivers income, the wait time and ride time for passengers, and the number of vehicles.
                                </p>
                                <p>
                                    Vehicles have operating costs of $0.25/km (including gas, depreciation, insurance, cleaning, maintenance). Drivers will enter the market if they can make $5/hour after these operating expenses. This means that drivers will enter the market if their gross income (before expenses) is more than $0.21 per minute.
                                </p>
                            </div>
                        </div>
                        <div id="what-if-chart-column" class="mdl-cell mdl-cell--8-col chart-column">
                            <!-- What if charts -->
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-n-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-phases-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-income-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-wait-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-platform-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="mdl-grid mdl-grid--no-spacing ui-zoom-hide"> -->
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--6-col-desktop ui-zoom-hide">
                            <table id="what-if-table-settings" class="what-if-table mdl-data-table mdl-js-data-table">
                                <thead>
                                    <tr>
                                        <th class="mdl-data-table__cell--non-numeric">
                                            Setting
                                        </th>
                                        <th class="mdl-data-table__cell--non-numeric">
                                            Baseline
                                        </th>
                                        <th class="mdl-data-table__cell--non-numeric">
                                            Comparison
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="what-if-table-settings-body">
                                </tbody>
                            </table>
                        </div>
                        <div class="mdl-cell mdl-cell--6-col-desktop ui-zoom-hide">
                            <table id="what-if-table-measures" class="what-if-table mdl-data-table mdl-js-data-table">
                                <thead>
                                    <tr>
                                        <th class="mdl-data-table__cell--non-numeric">
                                            Measure
                                        </th>
                                        <th class="mdl-data-table__cell--non-numeric">
                                            Baseline
                                        </th>
                                        <th class="mdl-data-table__cell--non-numeric">
                                            Comparison
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="what-if-table-measures-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mdl-layout__tab-panel" id="scroll-tab-read">
                <!-- this section is the "Read" tab -->
                <div class="page-content">
                    <div class="mdl-grid">
                        <div id="st1-grid" class="mdl-cell mdl-cell--6-col-desktop mdl-cell--3-offset-desktop" margin:auto="">
                            <h4>The ridehailing simulation model</h4>
                            <p>
                                The model is a work in progress. It is written in python and source code is available from
                                <a href="https://github.com/tomslee/ridehail-animation">GitHub.</a>
                            </p>
                            <h4>Contact</h4>
                            <p>
                                Email:
                                <a href="mailto:tom@tomslee.net?subject=Ridehail simulation">tom@tomslee.net</a>
                            </p>
                            <h4>Acknowledgements</h4>
                            <p>
                                The project was inspired in part by this
                                <a href="https://www.nytimes.com/interactive/2017/04/02/technology/uber-drivers-psychological-tricks.html">2017 New York Times interactive visualization</a>
                                (scroll down that page a bit).
                            </p>
                            <p>
                                The calculations run in the browser using the amazing
                                <a href="https://pyodide.org">Pyodide</a>
                                distribution, although you can also run it on a Linux or Windows desktop if you are OK with setting up and running python packages. It should run on a Mac too, but I have not verified that.
                            </p>
                            <p>
                                The site design is inspired by the impressive
                                <a href="https://playground.tensorflow.org/">TensorFlow Playground,</a>
                                and, like that site, uses
                                <a href="https://getmdl.io/started/index.html">Material Design Lite</a>
                                for components and layout.
                            </p>
                            <p>
                                Thanks also to Thorben and JJ from
                                <a href="https://ridefair.ca/">The RideFairTO Coalition,</a>
                                for encouragement, conversations, guidance, and contacts.
                            </p>
                            <p>
                                Errors and other flaws are all mine.
                            </p>
                            <div style="display:none">
                                <h4>Ridehailing</h4>
                                <p>
                                    Start with a community, which is a square grid with a number of "blocks" on each side.
                                </p>
                                <p>
                                    A vehicle drives randomly around the community. If it goes off one edge, it appears on the opposite edge. This turns out to be a useful simplification. You can also think of it as some vehicles leaving the area, and others entering.
                                </p>
                                <div class="button-and-chart">
                                    <table>
                                        <tr>
                                            <td>
                                                <div class="st-button-parent">
                                                    <button id="st1-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                                        <i class="material-icons">play_arrow</i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td>
                                                <div id="st1-chart-parent" class="st-canvas-parent">
                                                    <canvas id="st1-chart-canvas" class="st-chart-canvas"></canvas>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div>
                                    <p>
                                        In addition to vehicles, we need trips. Here is a vehicle driving around, and occasionally picking up a passenger for a trip.
                                    </p>
                                    <div>
                                        <p>
                                            The vehicle can be in three "phases".
                                            <ul>
                                                <li>
                                                    P1: it does not have a trip assigned, and is available. Sometimes this is called 'idle'. It is shown in blue.
                                                </li>
                                                <li>
                                                    P2: 'en route' to pick up a passenger. It is shown in an 'amber' colour.
                                                </li>
                                                <li>
                                                    P3: busy. The vehicle has a passenger
                                                </li>
                                            </ul>
                                        </p>
                                        <p>
                                            The trip origin is marked by a red diamond, and the trip destination (which shows up once the vehicle has picked up the passenger) is shown as a green circle (think of it as a target).
                                        </p>
                                        <p>
                                            When the red diamond is shown, the passenger is in a "waiting" state. When the red circle is shown, the passenger is in the vehicle.
                                        </p>
                                    </div>
                                    <div class="button-and-chart">
                                        <table>
                                            <tr>
                                                <td>
                                                    <div class="st-button-parent">
                                                        <button id="st2-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                                            <i class="material-icons">play_arrow</i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div id="st2-chart-parent" class="st-canvas-parent">
                                                        <canvas id="st2-chart-canvas" class="st-chart-canvas"></canvas>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mdl-layout__tab-panel" id="scroll-tab-TO">
                <!-- this section is the "Ridehail Toronto" tab: content has the TO or to- previx  -->
                <div id="tab-toronto" class="page-content">
                    <div class="mdl-grid">
                        <div id="to-grid-text-1" class="mdl-cell mdl-cell--3-col-desktop mdl-cell--1-offset-desktop" margin:auto="">
                            <h4>A starting point</h4>
                            <p>
                                First, let's see if this rough model can simulate a city like Toronto. Toronto is an area of 630km^2, modelled here as a 60*60 square city, with an average speed of 30 km/h, and each block representing one minute of travel. From p25 of
                                <a href="https://www.toronto.ca/wp-content/uploads/2021/11/98cd-VFHTransportationImpacts2021-11-23.pdf">The Transportation Impacts of Vehicle-for-Hire in Toronto: Oct 2018-July 2021</a>
                                (VFH2), on Feb 6 2020 the ridehail market in Toronto was like this:
                            </p>
                            <ul>
                                <li>
                                    194,000 trips (average 135/min)
                                </li>
                                <li>
                                    Average trip length of 8km (16 mins).
                                </li>
                                <li>
                                    Vehicle phases: 40.5% P1, 11.2% P2, 48.3% P3.
                                </li>
                                <li>
                                    Average wait time 2.1 minutes. This does not include the time between the driver "arriving" and the trip starting, so the time in this model should be a couple of minutes longer.
                                </li>
                                <li>
                                    Estimated average number of active vehicles: 6000 (eyeballing a chart).
                                </li>
                            </ul>
                            <p>
                                Using random trips, with a maximum length of 40mins (average trip length of 20 minutes), the chart shows that the simple model gets the P3 fraction right, but underestimates P2.
                            </p>
                            <p>
                                See
                                <a href="../toronto.html">this page</a>
                                for informal notes on data sources. The charts are generated by the desktop version of the model.
                            </p>
                        </div>
                        <div id="to-grid-chart-1" class="to-chart mdl-cell mdl-cell--7-col-desktop" margin:auto="">
                            <img width="100%" src="./img/feb6-1.png">
                        </div>
                    </div>
                    <div class="mdl-grid">
                        <div id="to-grid-text-2" class="mdl-cell mdl-cell--3-col-desktop mdl-cell--1-offset-desktop" margin:auto="">
                            <h4>Many trips take place in downtown Toronto</h4>
                            <p>
                                One additional step is to introduce two "zones": a downtown zone of 30 blocks by 30 blocks, in which more trip requests are made. Here, 40% more trip requests per block come from this downtown zone than from the outside areas - all other aspects remain the same. This one additional parameter gives the right P2 values. This seems to be the simplest model of a city that reproduces the broad features of a ride hail market or system.
                            </p>
                        </div>
                        <div id="to-grid-chart-2" class="to-chart mdl-cell mdl-cell--7-col-desktop" margin:auto="">
                            <img width="100%" src="./img/feb6-2.png">
                        </div>
                    </div>
                    <div class="mdl-grid">
                        <div id="to-grid-text-3" class="mdl-cell mdl-cell--3-col-desktop mdl-cell--1-offset-desktop" margin:auto="">
                            <h4>Supply and demand </h4>
                            <p>
                                A distinguishing feature of ridehail systems is that drivers are free to enter and leave at any time. Here, drivers will enter if they can earn more than a "reservation wage" and leave if the current pay is less. Driver earnings is the price, minus the platform commission, multiplied by the fraction of time they are driving (P3).
                            </p>
                            <p>
                                The fare in Toronto in 2020 is about $0.18/min and $0.81/km (
                                <a href="http://taxihowmuch.com/location/toronto-on-ca">source</a>
                                ), which equates to $0.58 per minute total. In addition there is a base fare (booking fee) that does not go to the driver (see
                                <a href="https://www.cbc.ca/news/canada/toronto/uber-drivers-upfront-fares-1.3973342">this CBC article</a>
                                , and so is not included here. Uber's commission is often said to be 25%.
                            </p>
                            <p>
                                The chart at right shows that, to sustain 6000 drivers at P3=48%, drivers must have a reservation wage (before any expenses) of $0.22 per minute, which is equivalent to $13/hour. Out of this must come vehicle expenses: if those are $0.20/km (the CRA suggestion is higher, at $0.50, but drivers do drive less when waiting for a ride, so this is a guess), which is $6/hr, then drivers are ending up with an income of $7/hr.
                            </p>
                        </div>
                        <div id="to-grid-chart-3" class="to-chart mdl-cell mdl-cell--7-col-desktop" margin:auto="">
                            <img width="100%" src="./img/feb6-3.png">
                        </div>
                    </div>
                    <div class="mdl-grid">
                        <div id="to-grid-text-4" class="mdl-cell mdl-cell--3-col-desktop mdl-cell--1-offset-desktop" margin:auto="">
                            <h4>Lowering the platform commission </h4>
                            <p>
                                If Uber decides to attract more drivers, it has several levers it can use. One is to lower its commission. What is the effect of a lower commission on driver income? It sounds like it should lead to higher incomes, but that's not what happens. Instead, the higher pay per ride attracts more drivers, so the fraction of time each driver is busy goes down until their income is the same reservation wage as before.
                            </p>
                            <p>
                                The lowered commission and consequent increase in vehicle numbers (from 6400 to 7200 in these runs) does lower wait times, but only marginally, reducing them by about 10%.
                            </p>
                        </div>
                        <div id="to-grid-chart-4" class="to-chart mdl-cell mdl-cell--7-col-desktop" margin:auto="">
                            <img width="100%" src="./img/feb6-4.png">
                        </div>
                    </div>
                    <div class="mdl-grid">
                        <div id="to-grid-text-5" class="mdl-cell mdl-cell--3-col-desktop mdl-cell--1-offset-desktop" margin:auto="">
                            <h4>Raising the platform commission </h4>
                            <p>
                                Going the other way, if Uber decides it needs to make more money and raises the commission, the number of vehicles falls (to 5700), each vehicle is busier so that each driver makes the same hourly wage as before, and the wait time is increased, again only slightly.
                            </p>
                            <p>
                                The effect of price and commission on demand for rides is not considered here.
                            </p>
                        </div>
                        <div id="to-grid-chart-5" class="to-chart mdl-cell mdl-cell--7-col-desktop" margin:auto="">
                            <img width="100%" src="./img/feb6-5.png">
                        </div>
                    </div>
                </div>
            </section>
            <script defer type="module" src="./main.js"></script>
        </main>
    </div>
</body>
</html>
