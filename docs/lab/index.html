<!DOCTYPE html>
<html lang="en">
<head lang="en">
    <meta charset="utf-8">
    <title>Tom Slee - Ridehail Laboratory</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=1024">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500|Material+Icons" rel="stylesheet">
    <!-- Material Icons (compatible with MD3) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js" integrity="sha256-RgW6ICRcHgz1vaGkL5egQAqmkWxGbwa2E3Boz/3CapM=" crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script> -->
    <!-- rendering on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>
<body>
    <!-- Always shows a header, even in smaller screens. -->
    <div class="app-layout">
        <header class="app-header ui-zoom-hide" role="banner">
            <div class="app-header-row">
                <!-- Title -->
                <h1 class="app-layout-title">Ridehail Laboratory v0.23 (2025-10-03)</h1>
                <!-- Add spacer, to align navigation to the right  -->
                <div class="app-layout-spacer"></div>
                <nav class="app-navigation" role="navigation" aria-label="Main site navigation">
                    <a class="app-navigation__link" href="https://tomslee.github.io" aria-label="Go to Tom Slee's homepage">Home</a>
                    <a class="app-navigation__link" href="https://tomslee.github.io/about.html" aria-label="About Tom Slee">About</a>
                    <a class="app-navigation__link" href="https://tomslee.github.io/essays.html" aria-label="Read essays">Essays</a>
                    <a class="app-navigation__link" href="https://tomslee.github.io/inprogress.html" aria-label="Work in progress">In Progress</a>
                </nav>
                <nav class="app-navigation app-navigation--large-screen-only" role="navigation" aria-label="External links">
                    <a class="app-navigation__link" href="https://github.com/tomslee/ridehail-animation" aria-label="View source code on GitHub" rel="external">GitHub</a>
                    <a class="app-navigation__link" href="https://github.com/tomslee/ridehail-animation/blob/dev/LICENSE" aria-label="View project license" rel="external">License</a>
                </nav>
            </div>
            <!-- Tabs -->
            <div class="app-tab-bar" role="tablist" aria-label="Main navigation">
                <a href="#scroll-tab-1" id="tab-experiment" class="app-tab is-active" role="tab" aria-selected="true" aria-controls="scroll-tab-1">
                    <span>Experiment</span>
                </a>
                <a href="#scroll-tab-what-if" id="tab-what-if" class="app-tab" role="tab" aria-selected="false" aria-controls="scroll-tab-what-if">
                    <span>What if?</span>
                </a>
                <a href="#scroll-tab-read" id="tab-read" class="app-tab" role="tab" aria-selected="false" aria-controls="scroll-tab-read">
                    <span>Read</span>
                </a>
                <a href="#scroll-tab-TO" id="tab-TO" class="app-tab" role="tab" aria-selected="false" aria-controls="scroll-tab-TO">
                    <span>Ridehail in Toronto</span>
                </a>
            </div>
        </header>
        <main class="app-content">
            <section class="app-tab-panel is-active" id="scroll-tab-1" role="tabpanel" aria-labelledby="tab-experiment">
                <!-- this section is the "Experiment" tab -->
                <div class="page-content">
                    <!-- lab / experiment content -->
                    <div class="app-grid">
                        <div class="app-cell app-cell--12">
                            <!-- top controls -->
                            <div id="top-controls" class="top-controls app-control-panel">
                                <div class="top-controls-inner">
                                    <div class="top-control">
                                        <div class="top-control__label">Controls</div>
                                        <div class="timeline-controls">
                                            <button class="app-button app-button--toolbar-icon ui-resetButton" id="reset-button" title="Reset simulation" disabled>
                                                <i class="material-icons">replay</i>
                                            </button>
                                            <button id="fab-button" class="app-button app-button--toolbar app-button--toolbar-primary" title="Run or pause simulation" disabled>
                                                <i class="material-icons">play_arrow</i>
                                                <span class="app-button__text">Run</span>
                                            </button>
                                            <button class="app-button app-button--toolbar-icon ui-stepButton" id="next-step-button" title="Step forward one frame" disabled>
                                                <i class="material-icons">skip_next</i>
                                            </button>
                                        </div>
                                    </div>
                                <div class="top-control">
                                    <div class="top-control__label">Frame</div>
                                    <div class="value" id="frame-count">
                                        0
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div class="top-control__label">Scale</div>
                                    <div class="app-radio-group">
                                        <label for="radio-community-village" class="app-radio-chip">
                                            <input type="radio" id="radio-community-village" name="scale" value="village" class="app-radio-chip__input" checked>
                                            <span class="app-radio-chip__label">Village</span>
                                        </label>
                                        <label for="radio-community-town" class="app-radio-chip">
                                            <input type="radio" id="radio-community-town" name="scale" value="town" class="app-radio-chip__input">
                                            <span class="app-radio-chip__label">Town</span>
                                        </label>
                                        <label for="radio-community-city" class="app-radio-chip">
                                            <input type="radio" id="radio-community-city" name="scale" value="city" class="app-radio-chip__input">
                                            <span class="app-radio-chip__label">City</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div class="top-control__label">Chart type</div>
                                    <div class="app-radio-group">
                                        <label for="radio-chart-type-map" class="app-radio-chip">
                                            <input type="radio" id="radio-chart-type-map" class="app-radio-chip__input" name="chart-type" value="map" checked>
                                            <span class="app-radio-chip__label">Map</span>
                                        </label>
                                        <label for="radio-chart-type-stats" class="app-radio-chip">
                                            <input type="radio" id="radio-chart-type-stats" class="app-radio-chip__input" name="chart-type" value="stats">
                                            <span class="app-radio-chip__label">Statistics</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div class="top-control__label">Mode</div>
                                    <div class="app-radio-group">
                                        <label for="radio-ui-mode-simple" class="app-radio-chip">
                                            <input type="radio" id="radio-ui-mode-simple" name="ui-mode" value="simple" class="app-radio-chip__input" checked>
                                            <span class="app-radio-chip__label">Simple</span>
                                        </label>
                                        <label for="radio-ui-mode-advanced" class="app-radio-chip">
                                            <input type="radio" id="radio-ui-mode-advanced" name="ui-mode" value="advanced" class="app-radio-chip__input">
                                            <span class="app-radio-chip__label">Costs &amp; Incomes</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div class="top-control__label">Configuration</div>
                                    <div class="app-button-group">
                                        <button class="app-button app-button--toolbar-icon" id="download-config" title="Download configuration">
                                            <i class="material-icons">download</i>
                                        </button>
                                        <label for="upload-config" class="app-button app-button--toolbar-icon" title="Upload configuration">
                                            <i class="material-icons">upload</i>
                                            <input type="file" id="upload-config" accept=".config" hidden>
                                        </label>
                                    </div>
                                </div>
                                <div id="drop-zone" class="top-control drop-zone">
                                    <div class="drop-zone-content">
                                        <i class="material-icons drop-zone-icon">cloud_upload</i>
                                        <span class="drop-zone-text">Drop .config file here</span>
                                    </div>
                                </div>
                                </div>
                            </div>
                            <!-- end of top-controls -->
                        </div>
                        <div id="column-1" class="app-cell app-cell--4 ui-zoom-hide">
                            <!-- text column -->
                            <div class="ui-mode-simple">
                                <h5>Start here</h5>
                                <p>
                                    When the ridehail simulator has loaded, click the "Run" button, above. The simulator runs entirely in your browser (not on a server), so you cannot break it and nobody tracks what you do.
                                </p>
                                <p>
                                    The map shows a model city as a square of
                                    <b>blocks.</b>
                                    Ridehail vehicles (shown as triangles) drive the streets, waiting to be assigned a trip. When a passenger requests a trip (red diamond), it is assigned to a vehicle, which takes them to their destination (green circle).
                                </p>
                                <p>
                                    Choose a community
                                    <b>Scale</b>
                                    of village, town, or city to set a starting point. There are some keyboard shortcuts: press
                                    <b>z</b>
                                    on your keyboard to zoom in on the map, and again to zoom back out. Press
                                    <b>p</b>
                                    to pause and to resume. Press <b>s</b> when paused to single-step forward. Press <b>h</b> to see a list of all keyboard shortcuts.
                                </p>
                                <p>
                                    Choose a
                                    <b>Chart type</b>
                                    of "Statistics" to show wait times, how driver time is split between different activities, and driver income (before and after expenses).
                                </p>
                                <p>
                                    With the
                                    <b>Mode</b>
                                    to "Simple Model" the stats are just calculated per-block. If you set the Mode to "Costs &amp; Incomes" you can set fares and costs based on kilometers and minutes.
                                </p>
                                <p>
                                    The simulation outcomes depend on many factors. Experiment with changing the size of the community, the number of vehicles, and the rate of requests. If you check "Free entry &amp; exit" then drivers will become active if there is money to be made (over and above their 'reservation wage'), and leave it if there is not. Choose "Costs &amp; Incomes" to set fares and driver costs.
                                </p>
                                <p>
                                    How do wait times, driver "busy" times, and incomes change with the ridehail environment? Set up a simulation here, then go to the
                                    <b>What If?</b>
                                    tab to explore how policy or other changes affect the outcoms.
                                </p>
                                <p>
                                    For more information, click
                                    <b>Read</b>
                                    in the coloured title bar (under construction!). If things go wrong, press the "reset" button at the top left.
                                </p>
                            </div>
                            <div class="ui-mode-advanced">
                                <h5>Costs &amp; incomes</h5>
                                <p>
                                    You have chosen the "Costs &amp; Incomes" mode, which lets you link the model to more real-world values. In this mode, each block represents a minute of travel time. At an average speed of 30 km/h (which is realistic, as it includes all stopping times and pickup times) each block is 0.5km. You can set the following monetary parameters:
                                </p>
                                <ul>
                                    <li>
                                        "Per km" fare component. In Toronto this is roughly $0.80 for UberX.
                                    </li>
                                    <li>
                                        "Per minute" fare component. In Toronto this is roughly $0.20 for UberX.
                                    </li>
                                </ul>
                                <p>
                                    At an average speed of 30 km/h, these two values produce a fare of $0.60 per minute (per block, in this model). In addition to these components, UberX fares include a fixed "booking fee". As this is not passed on to the driver, it has no effect on driver income and is ignored here, for now.
                                </p>
                                <ul>
                                    <li>
                                        "Vehicle operating cost per km". One estimate of this would be $0.50/km, which is the lower end of the
                                        <a href="https://www.canada.ca/en/revenue-agency/services/tax/businesses/topics/payroll/benefits-allowances/automobile/automobile-motor-vehicle-allowances/reasonable-kilometre-allowance.html">Revenue Canada "reasonable allowance rates"</a>
                                        for reimbursement of employee use of a vehicle for business purposes. However, the model does not currently allow for the fact that drivers drive more slowly (or park) while in P1 phase (waiting for a ride). A $0.30/km estimate may be more reasonable until the slower driving in P1 is included.
                                    </li>
                                    <li>
                                        "Vehicle opportunity cost per hour". This is the money, after all expenses, that a driver would need to make in order to work.
                                    </li>
                                </ul>
                                <p>
                                    Adding these together gives the "reservation wage".
                                </p>
                            </div>
                        </div>
                        <div id="column-2" class="app-cell app-cell--2">
                            <!-- input settings -->
                            <h5>Ridehail environment</h5>
                            <div class="ui-ridehail-settings ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-city-size" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Area (blocks per side)</span>
                                        <span class="value" id="option-city-size">8</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-city-size" class="app-slider" type="range" min="4" max="16" value="8" step="2">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Each block = distance traveled in one minute
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-inhomogeneity" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Two zones (central favor)</span>
                                        <span class="value" id="option-inhomogeneity">0</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-inhomogeneity" class="app-slider" type="range" min="0" max="1" value="0.0" step="0.1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        0=even distribution, 1=all requests in central zone
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-max-trip-distance" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Max trip length (blocks)</span>
                                        <span class="value" id="option-max-trip-distance">8</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-max-trip-distance" class="app-slider" type="range" min="0" max="8" value="8" step="1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Maximum distance for trip destinations
                                    </p>
                                </div>
                            </div>
                            <h5>Vehicles (supply)</h5>
                            <div class="ui-ridehail-settings ui-mode-simple app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-vehicle-count" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Ridehail vehicles</span>
                                        <span class="value" id="option-vehicle-count">8</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-vehicle-count" class="app-slider" type="range" min="1" max="16" value="8" step="1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Active vehicles in the area (changes with "Free entry & exit")
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-mean-vehicle-speed" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Mean vehicle speed (km/h)</span>
                                        <span class="value" id="option-mean-vehicle-speed">30</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-mean-vehicle-speed" class="app-slider" type="range" min="10" max="50" value="30" step="5">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Average speed including stops and pickups
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-per-km-ops-cost" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Operations cost ($/km)</span>
                                        <span class="value" id="option-per-km-ops-cost">0.25</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-per-km-ops-cost" class="app-slider" type="range" min="0" max="1" value="0.25" step="0.05">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Cost of running a vehicle per kilometer
                                    </p>
                                </div>
                            </div>
                            <h5>Trip requests (demand)</h5>
                            <div class="ui-ridehail-settings ui-mode-simple app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-request-rate" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Trip requests</span>
                                        <span class="value" id="option-request-rate">0.5</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-request-rate" class="app-slider" type="range" min="0" max="4" value="0.5" step="0.1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Requests per vehicle block time (changes with "Free entry & exit")
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-demand-elasticity" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Demand elasticity</span>
                                        <span class="value" id="option-demand-elasticity">0</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-demand-elasticity" class="app-slider" type="range" min="0" max="2.00" value="0.00" step="0.1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        How request rate responds to fare changes (0=no change)
                                    </p>
                                </div>
                            </div>
                            <h5>Entry and exit</h5>
                            <div class="ui-ridehail-settings app-settings-card">
                                <div class="app-settings-card__content">
                                    <label class="app-toggle" for="checkbox-equilibrate">
                                        <input type="checkbox" id="checkbox-equilibrate" class="app-toggle__input">
                                        <span class="app-toggle__track">
                                            <span class="app-toggle__thumb"></span>
                                        </span>
                                        <span class="app-toggle__label">Free entry &amp; exit</span>
                                    </label>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Vehicles enter when there is money to be made above the "reservation wage", and leave when they cannot make money
                                    </p>
                                </div>
                            </div>
                            <h5>Fares</h5>
                            <div class="ui-ridehail-settings ui-mode-simple ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-price" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Fare</span>
                                        <span class="value" id="option-price">1.20</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-price" class="app-slider" type="range" min="0" max="4.0" value="1.2" step="0.1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Fare per block
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-per-km-price" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Per km fare ($)</span>
                                        <span class="value" id="option-per-km-price">0.80</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-per-km-price" class="app-slider" type="range" min="0" max="1.20" value="0.80" step="0.1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Distance component of fare
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-per-minute-price" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Per minute fare ($)</span>
                                        <span class="value" id="option-per-minute-price">0.20</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-per-minute-price" class="app-slider" type="range" min="0" max="0.40" value="0.20" step="0.05">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Time component of fare
                                    </p>
                                </div>
                            </div>
                            <h5 class="ui-mode-advanced">Platform income</h5>
                            <div class="ui-ridehail-settings ui-mode-advanced app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-platform-commission" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Platform commission</span>
                                        <span class="value" id="option-platform-commission">0.25</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-platform-commission" class="app-slider" type="range" min="0" max="0.5" value="0.25" step="0.01">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Fraction of fare kept by platform
                                    </p>
                                </div>
                            </div>
                            <h5>Driver income</h5>
                            <div class="ui-ridehail-settings ui-mode-simple ui-mode-reset app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-reservation-wage" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Reservation wage</span>
                                        <span class="value" id="option-reservation-wage">0.35</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-reservation-wage" class="app-slider" type="range" min="0" max="1" value="0.35" step="0.05">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Minimum income per block worth driving for
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset ui-mode-equilibrate app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-per-hour-opportunity-cost" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Opportunity cost ($/hr)</span>
                                        <span class="value" id="option-per-hour-opportunity-cost">10</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-per-hour-opportunity-cost" class="app-slider" type="range" min="0" max="30" value="10" step="1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Minimum income for vehicle entry/exit
                                    </p>
                                </div>
                            </div>
                            <h5>Display</h5>
                            <div class="ui-ridehail-settings ui-money-options ui-mode-reset ui-mode-advanced app-settings-card">
                                <div class="app-settings-card__content">
                                    <label for="input-smoothing-window" class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Chart smoothing (frames)</span>
                                        <span class="value" id="option-smoothing-window">20</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-smoothing-window" class="app-slider" type="range" min="1" max="32" value="20" step="1">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Rolling average window for statistics charts
                                    </p>
                                </div>
                            </div>
                            <div class="ui-ridehail-settings ui-display-options ui-mode-simple app-settings-card">
                                <div class="app-settings-card__content">
                                    <label class="app-settings-card__label">
                                        <span class="app-settings-card__label-text">Animation delay (ms)</span>
                                        <span class="value" id="option-animation-delay">300</span>
                                    </label>
                                    <div class="app-slider-container">
                                        <input id="input-animation-delay" class="app-slider" type="range" min="0" max="1000" value="300" step="10">
                                        <div class="app-slider-track"></div>
                                    </div>
                                    <p class="ui-zoom-hide app-settings-card__description">
                                        Lower values speed up animation
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div id="chart-column" class="app-cell app-cell--6 chart-column">
                            <!-- Map and statistics charts -->
                            <div class="lab-canvas-parent" hidden>
                                <canvas id="lab-city-chart-canvas" class="lab-chart-canvas"></canvas>
                            </div>
                            <div class="lab-canvas-parent" hidden>
                                <canvas id="lab-phases-chart-canvas" class="lab-chart-canvas"></canvas>
                            </div>
                            <div class="lab-canvas-parent" hidden>
                                <canvas id="lab-trip-chart-canvas" class="lab-chart-canvas"></canvas>
                            </div>
                            <div class="lab-canvas-parent" hidden>
                                <canvas id="lab-income-chart-canvas" class="lab-chart-canvas"></canvas>
                            </div>
                            <div class="lab-canvas-parent lab-map-canvas-parent">
                                <canvas id="lab-map-chart-canvas" class="lab-chart-canvas"></canvas>
                            </div>
                            <!--
                            <div id="lab-dummy-canvas-parent" class="lab-canvas-parent lab-map-canvas-parent">
                                <canvas id="lab-dummy-chart-canvas" class="lab-chart-canvas"></canvas>
                                 dummy filler 
                            </div>
                            -->
                            <div id="lab-stats-descriptions" class="lab-stats-descriptions" hidden>
                                <h5>Driver earnings key</h5>
                                <ul>
                                    <li>
                                        <b>On-the-clock:</b>
                                        hourly pay rate while drivers have a passenger in the car. The fare the customer pays, minus the platform commission.
                                    </li>
                                    <li>
                                        <b>Gross:</b>
                                        actual hourly pay before any expenses. The "on-the-clock" pay, adjusted for the proportion of the time the driver has a passenger ("P3" time).
                                    </li>
                                    <li>
                                        <b>Net:</b>
                                        hourly income after operating expenses.
                                    </li>
                                    <li>
                                        <b>Surplus:</b>
                                        hourly income above the reservation wage. In the case of "Costs &amp; Incomes", the reservation wage is the sum of the operating expenses and the opportunity cost.
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="app-tab-panel" id="scroll-tab-what-if" role="tabpanel" aria-labelledby="tab-what-if">
                <!-- this section is the "What if?" tab -->
                <div class="page-content">
                    <div class="app-grid">
                        <div class="app-cell app-cell--12">
                            <div id="what-if-top-controls" class="top-controls app-control-panel">
                                <div class="top-controls-inner">
                                <div class="what-if-timeline-controls top-control">
                                    <div class="top-control__label">Choose baseline</div>
                                    <div class="app-radio-group">
                                        <label id="what-if-radio-baseline-preset-label" for="what-if-radio-baseline-preset" class="app-radio-chip">
                                            <input type="radio" id="what-if-radio-baseline-preset" name="what-if-radio-baseline" class="app-radio-chip__input" value="preset" checked>
                                            <span class="app-radio-chip__label">Preset</span>
                                        </label>
                                        <label id="what-if-radio-baseline-lab-label" for="what-if-radio-baseline-lab" class="app-radio-chip">
                                            <input type="radio" id="what-if-radio-baseline-lab" name="what-if-radio-baseline" value="lab" class="app-radio-chip__input">
                                            <span class="app-radio-chip__label">Experiment</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div class="top-control__label">Controls</div>
                                    <div class="what-if-timeline-controls">
                                        <button class="app-button app-button--toolbar-icon ui-resetButton" id="what-if-reset-button" title="Reset simulation" disabled>
                                            <i class="material-icons">replay</i>
                                        </button>
                                        <button id="what-if-baseline-fab-button" class="app-button app-button--toolbar app-button--toolbar-primary" title="Run or pause baseline simulation">
                                            <i class="material-icons">play_arrow</i>
                                            <span class="app-button__text">Run Baseline</span>
                                        </button>
                                        <button id="what-if-comparison-fab-button" class="app-button app-button--toolbar app-button--toolbar-secondary" disabled title="Run or pause comparison simulation">
                                            <i class="material-icons">play_arrow</i>
                                            <span class="app-button__text">Run Comparison</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="what-if-timeline-controls top-control">
                                        <div class="top-control__label">Frame</div>
                                    <div class="value" id="what-if-frame-count">
                                        0
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div class="top-control__label">Fare / minute</div>
                                    <div class="app-stepper">
                                        <button id="what-if-price-remove" class="app-stepper__button">−</button>
                                        <span id="what-if-price" class="app-stepper__value"></span>
                                        <button id="what-if-price-add" class="app-stepper__button">+</button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div class="top-control__label">Commission</div>
                                    <div class="app-stepper">
                                        <button id="what-if-commission-remove" class="app-stepper__button">−</button>
                                        <span id="what-if-commission" class="app-stepper__value"></span>
                                        <button id="what-if-commission-add" class="app-stepper__button">+</button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control" hidden>
                                    <div class="top-control__label">Vehicle cap</div>
                                    <div class="app-stepper">
                                        <button id="what-if-cap-remove" class="app-stepper__button">−</button>
                                        <span id="what-if-cap" class="app-stepper__value"></span>
                                        <button id="what-if-cap-add" class="app-stepper__button">+</button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div class="top-control__label">Reservation wage /hr</div>
                                    <div class="app-stepper">
                                        <button id="what-if-reservation-wage-remove" class="app-stepper__button">−</button>
                                        <span id="what-if-reservation-wage" class="app-stepper__value"></span>
                                        <button id="what-if-reservation-wage-add" class="app-stepper__button">+</button>
                                    </div>
                                </div>
                                <div class="what-if-set-comparison top-control">
                                    <div class="top-control__label">Demand (trips/hr)</div>
                                    <div class="app-stepper">
                                        <button id="what-if-demand-remove" class="app-stepper__button">−</button>
                                        <span id="what-if-demand" class="app-stepper__value"></span>
                                        <button id="what-if-demand-add" class="app-stepper__button">+</button>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div id="what-if-column-1" class="app-cell app-cell--4 ui-zoom-hide">
                            <!-- descriptive text column on the left -->
                            <div class="app-cell app-cell--12">
                                <p>
                                    Click the orange button to run a baseline simulation. Then change one or more of the settings and run a Comparison to see how those changes affect outcomes for drivers, passengers, and platforms.
                                </p>
                                <p>
                                    Choose a baseline of
                                    <b>Experiment</b>
                                    to copy the current settings from the Experiment tab to here, and explore how policy, platform, or environment changes affect the outcomes.
                                </p>
                                <p>
                                    Choose a baseline of
                                    <b>Preset</b>
                                    to use a ridehail environment similar to the "Town" on the Experiment tab.
                                </p>
                                <p>
                                    Whichever baseline you choose, you can see the detailed settings used in the table below once you start the simulation. The
                                    <b>Measures</b>
                                    table shows the simulation outcomes.
                                </p>
                            </div>
                        </div>
                        <div id="what-if-chart-column" class="app-cell app-cell--8 chart-column">
                            <!-- What if charts -->
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-n-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-demand-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-phases-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-income-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-wait-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                            <div class="what-if-canvas-parent">
                                <canvas id="what-if-platform-chart-canvas" class="what-if-chart-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="app-grid app-grid--no-spacing ui-zoom-hide"> -->
                    <div class="app-grid">
                        <div class="app-cell app-cell--6">
                            <div class="app-table-card">
                                <table id="what-if-table-settings" class="what-if-table app-table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Setting
                                            </th>
                                            <th>
                                                Baseline
                                            </th>
                                            <th>
                                                Comparison
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="what-if-table-settings-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="app-cell app-cell--6">
                            <div class="app-table-card">
                                <table id="what-if-table-measures" class="what-if-table app-table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Measure
                                            </th>
                                            <th>
                                                Baseline
                                            </th>
                                            <th>
                                                Comparison
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="what-if-table-measures-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="app-tab-panel" id="scroll-tab-read" role="tabpanel" aria-labelledby="tab-read">
                <!-- this section is the "Read" tab -->
                <div class="page-content">
                    <div class="app-grid">
                        <div id="st1-grid" class="app-cell app-cell--12">
                            <h4>The ridehailing simulation model</h4>
                            <p>
                                Many current debates and discussions about Uber and other ridehail systems rely either on data provided by the ridehail companies themselves, or on broad qualitative claims. The goal of this simulation is to fit a gap in the middle. The simulation is quantitative, and can be calibrated against broad aggregate statistics, such as utilization rates for a city, which are more widely available than detailed statistical data. The simulation is intended to be as simple as possible while still capturing the essential elements of a ridehail system: vehicles and trips in a generic "city". It is a work in progress that, if it turns out well, may enable some of the following:
                            </p>
                            <ul>
                                <li>
                                    Some policy debates fall into talk at cross purposes, with different unstated assumptions underlying rival claims. I hope a computer simulation lets some of these assumptions be checked.
                                </li>
                                <li>
                                    Driver income for gig economy companies such as Uber is related to passenger fares in a different way to “normal” pay for service. Simulation helps us to see how “minimum wage” proposals that do not cover time waiting for an assignment fail to address the problems that drivers face.
                                </li>
                                <li>
                                    A simple model that is independent of a particular city geography and road layout is easier for comparisons of the ridehail experience among cities.
                                </li>
                                <li>
                                    A computer simulation allows “what if?” experiments that may provide insights into the tradeoffs faced by platform companies, municipal governments, drivers and passengers.
                                </li>
                            </ul>
                            <p>
                                It is a work in progress. It is written in python and source code is available from
                                <a href="https://github.com/tomslee/ridehail">GitHub.</a>
                                It can be run either in the browser (here) or as a desktop application.
                            </p>
                            <h5>Configuration Files</h5>
                            <p>
                                You can now save and load your experiment configurations using the download and upload buttons in the toolbar. This enables seamless workflow between the web laboratory and desktop application.
                            </p>
                            <p>
                                <strong>Download:</strong> Click the download button (↓) to save your current settings as a <code>.config</code> file. The file is compatible with the desktop application and includes all parameters: city size, vehicle count, pricing, equilibration settings, and more.
                            </p>
                            <p>
                                <strong>Upload:</strong> Click the upload button (↑) to load a previously saved configuration file. The system will automatically:
                            </p>
                            <ul>
                                <li>Detect the appropriate scale (Village, Town, or City) based on parameter values</li>
                                <li>Adjust any out-of-range values to fit within the selected scale's constraints</li>
                                <li>Show you a summary of the configuration and any adjustments before applying</li>
                                <li>Update all controls and reset the simulation with the new settings</li>
                            </ul>
                            <p>
                                <strong>Desktop Compatibility:</strong> Configuration files use the same INI format as the desktop application, enabling you to:
                            </p>
                            <ul>
                                <li>Start experimenting in the browser, download your config, and continue on desktop for more extensive analysis</li>
                                <li>Create configurations on desktop, upload to the web lab for quick visualization</li>
                                <li>Share configurations with collaborators across platforms</li>
                            </ul>
                            <p>
                                <strong>Note on Scale Inference:</strong> The desktop application doesn't have the Village/Town/City scale concept - it accepts any valid parameter values. When you upload a desktop config file, the web lab automatically selects the smallest scale that can accommodate all parameter values. If some values exceed the maximum for that scale, they will be adjusted (clamped) and you'll see a warning in the confirmation dialog.
                            </p>
                            <p>
                                The ridehail simulation has three components:
                                <ul>
                                    <li>
                                        A geographical area. This is called a City, as most discussions about ridehail systems have focused on cities as the unit of comparison, but it need not be an actual “city”.
                                    </li>
                                    <li>
                                        Vehicles. These drive around the city, respond to trip requests, and carry passengers from the trip origin to the trip destination.
                                    </li>
                                    <li>
                                        Trips. These start as trip requests, and have an origin and destination within the city.
                                    </li>
                                </ul>
                            </p>
                            <h5>The city</h5>
                            <p>
                                A city is represented as simply as possible: it is a square of uniformly-sized blocks, with C blocks on each side of the square. The square is, however, “wrapped”, so that a vehicle going off the top of the city appears at the bottom, and a vehicle going off the right of the city appears on the left. This is not as unrealistic as it may first appear: in the real world, drivers are not bound by city boundaries: some trips will go outside the city and some will come from outside in, so the City can be thought of as an area with vehicles leaving and entering. In this uniform city, all locations are identical. A city with distinct zones is also allowed, and is described below.
                            </p>
                            <p>
                                A single block is the unit of travel, and may be thought of as a distance or a time of travel, or a combination of the two. In practice it is often taken as a minute of travel time, but this is not a requirement.
                            </p>
                            <h5>Vehicles</h5>
                            <p>
                                Vehicles all drive at the same speed, and are always in one of three “phases”, which are commonly used in discussions of ridehail systems.
                            </p>
                            <p>
                                In “P1” they are available to be assigned for trips, but do not have an assigned trip. In this phase they drive randomly around the city. Vehicles in P1 are also sometimes called “idle”.
                            </p>
                            <p>
                                In “P2” a vehicle is assigned to a trip, and drives towards the trip origin by the shortest route to pick up the passenger. This route may involve going “off the edge” of the city and appearing at the opposite side. P2 is sometimes called “en route” to picking up the passenger.
                            </p>
                            <p>
                                In “P3”, a vehicle has a passenger and is driving by the shortest route to the destination. Evaluated across the whole driver population, the proportion of time drivers spend in P3 is also the utilization rate for the system. Once the trip is complete, the vehicle returns to P1.
                            </p>
                            <h5>Trips</h5>
                            <p>
                                A trip has an origin and a destination. In the simplest simulation, each is chosen randomly from intersections in the city, except that the two locations cannot be the same.
                            </p>
                            <p>
                                Each vehicle can take only one trip at a time. This can be thought of as one passenger or a group of passengers, but it does not include “shared trips” such as the “Uber Pool” service where (groups of) passengers request trips separately but share a vehicle for some portion of the trip. RIdehail operators have repeatedly tried to introduce such systems but, even before Covid, such shared trips made up a small portion of the total trips, and even when a passenger requested an “Uber Pool” trip they often end up not sharing the vehicle. The simulation focuses entirely on “UberX-like” systems.
                            </p>
                            <p>
                                Trip time is in one of two phases: waiting or traveling. For randomly-selected trip origns and destinations, the average trip length in a city with C blocks along each side is C/2.
                            </p>
                            <p>
                                The “wait time” here, between placing a trip request and the arrival of the vehicle does not exactly match that commonly used by Uber. For Uber, the wait time is the time until the driver appears at the location, but that leaves an unassigned period between arrival and the start of the trip, which may include time for the passenger to come out onto the street, find the vehicle (or for the driver to pick out the passenger), and get in the vehicle.
                            </p>
                            <h5>The simulation</h5>
                            <p>
                                Each simulation is a sequence of moves, in each of which vehicles travel one block. A typical move involves the following events:
                            </p>
                            <ol>
                                <li>
                                    Any new trip requests are generated and made.
                                </li>
                                <li>
                                    Available vehicles are assigned to trips. The trip is assigned to the nearest available vehicle in P1, and if there are multiple vehicles at the same distance from the trip origin, one is selected at random. Vehicles always accept trip assignments.
                                </li>
                                <li>
                                    Vehicles move from one intersection to the next. For each vehicle, this involves choosing a direction and moving a block to the next intersection. For vehicles in P1, the direction is random; for vehicles in P2 and P3, the direction is towards the trip origin or destination, as applicable.
                                </li>
                                <li>
                                    Any trip that reaches its destination terminates.
                                </li>
                            </ol>
                            <p>
                                At the end of each move, the simulation records and optionally plots the state of each vehicle and statistics about the overall system (fraction of vehicles in each phase, for example).
                            </p>
                            <p>
                                The simulation is implemented in the Python programming language, and the code is available on GitHub. It can be run as a desktop application from a command line or at a web site.
                            </p>
                            <p>
                                The desktop application is controlled by a configuration file, which at its simplest specifies the size of the city (number of blocks on each side), the base demand rate (number of trip requests each move), and the number of vehicles.
                            </p>
                            <p>
                                The simulation is also available at a web site, where the configuration is set in the browser. The simulation runs in the browser (not at a server), using the Pyodide python distribution, and is the same code as the desktop. The web site is currently a “laboratory, which allows experimentation but does not provide a way to save results. All results in this report are taken from desktop simulations.
                            </p>
                            <h5>Entry and exit</h5>
                            <p>
                                The description so far could apply to any taxi-like system. An element of the gig-economy ridehail business model is that drivers can enter and exit at any time, by signing into the application or turning it off. The simulation captures entry and exit of drivers as follows.
                            </p>
                            <p>
                                Each trip is assigned a price per block p, with the ridehail platform taking a fraction of that price as a commission (m). Driver gross income before expenses is therefore
                                <pre>I = p<sub>3</sub> . p . (1 – m)</pre>
                            </p>
                            <p>
                                Drivers also have costs. These include fixed costs, marginal cost of operations (fuel, insurance, maintenance, cleaning, etc.) and “opportunity costs” co, which is the value of other things they could be doing at the same time. The opportunity costs can also be considered as the reservation wage (cw): the after-expenses income a driver must make for driving to be worth their while.
                            </p>
                            <p>
                                Phrased another way, the “driver utility” U is
                                <pre>U = p<sub>3</sub>. p . (1 – m) – c<sub>o</sub> - c<sub>w</sub></pre>
                            </p>
                            <p>
                                Periodically, a simulation with equilibration enabled computes the average driver utility for the system as a whole based on the entered price, commission, and costs (which all stay constant for a simulation), and also on the observed utilization rate p3. If U is greater than zero (income after expenses is greater than the reservation wage) then there is money to be made by drivers, and more vehicles enter the system. If U is less than zero, then for some drivers it is not worth their time to be driving and they leave the system. Over time, the system equilibrates to a steady state.
                            </p>
                            <h5>Mapping to cities</h5>
                            <p>
                                While the simulation is carried out entirely in abstract units of blocks, and currency-free prices and costs, the configuration also allows these to be derived from less abstract quantities. If a “real-world” option is chosen, the configuration can separately enter prices per km and per minute; driver costs can be assigned per km (operational costs) and per minute (opportunity costs), and an average speed connects the relationship between space and time so that a “block” has an assigned time and distance. These values are translated into the abstract prices and costs per block.
                            </p>
                            <h5>Extensions</h5>
                            <p>
                                Several additional refinements have been implemented, but the spirit of the simulation is to be as simple as possible, so that it can be calibrated using the very limited high-level public data available and so that it can be used comparatively. However, two are necessary for some applications below.
                            </p>
                            <p>
                                Many cities have a central “downtown” zone where the demand for ridehail traffic is high, surrounded by suburban areas where demand is lower. This inhomogeneity is built into the model as two zones. A central zone has sides C/2 (so, one quarter of the city’s area) and has a higher rate of trip requests than the surrounding area. The trip destinations remain randomly distributed around the whole city. With an inhomogeneity of zero, the central zone is the same as the rest, with an inhomogeneity of one all trip requests take place in the central zone. In this way, and in the sprit of keeping the model as simple and parsimonious as possible, a single inhomogeneity parameter between zero and one captures the two zones.
                            </p>
                            <p>
                                The use of random locations for trip destinations implies an average trip length of C/2 (regardless of inhomogeneity). To model an area where the average trip length may differ from this, a maximum trip length can be set, with trips distributed randomly over intersections within that distance. This maximum trip length is mentioned below.
                            </p>
                            <h4>Contact</h4>
                            <p>
                                Email:
                                <a href="mailto:tom@tomslee.net?subject=Ridehail simulation">tom@tomslee.net</a>
                            </p>
                            <h4>Acknowledgements</h4>
                            <p>
                                The project was inspired in part by this
                                <a href="https://www.nytimes.com/interactive/2017/04/02/technology/uber-drivers-psychological-tricks.html">2017 New York Times interactive visualization</a>
                                (scroll down that page a bit).
                            </p>
                            <p>
                                The calculations run in the browser using the amazing
                                <a href="https://pyodide.org">Pyodide</a>
                                distribution, although you can also run it on a Linux or Windows desktop if you are OK with setting up and running python packages. It should run on a Mac too, but I have not verified that.
                            </p>
                            <p>
                                The site design is inspired by the impressive
                                <a href="https://playground.tensorflow.org/">TensorFlow Playground,</a>
                                and uses
                                <a href="https://material.io/design">Material Design 3</a>
                                for components and layout.
                            </p>
                            <p>
                                Thanks also to Thorben and JJ from
                                <a href="https://ridefair.ca/">The RideFairTO Coalition,</a>
                                for encouragement, conversations, guidance, and contacts.
                            </p>
                            <p>
                                Errors and other flaws are all mine.
                            </p>
                            <div style="display:none">
                                <h4>Ridehailing</h4>
                                <p>
                                    Start with a community, which is a square grid with a number of "blocks" on each side.
                                </p>
                                <p>
                                    A vehicle drives randomly around the community. If it goes off one edge, it appears on the opposite edge. This turns out to be a useful simplification. You can also think of it as some vehicles leaving the area, and others entering.
                                </p>
                                <div class="button-and-chart">
                                    <table>
                                        <tr>
                                            <td>
                                                <div class="st-button-parent">
                                                    <button id="st1-button" class="app-button app-button--mini-fab">
                                                        <i class="material-icons">play_arrow</i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td>
                                                <div id="st1-chart-parent" class="st-canvas-parent">
                                                    <canvas id="st1-chart-canvas" class="st-chart-canvas"></canvas>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div>
                                    <p>
                                        In addition to vehicles, we need trips. Here is a vehicle driving around, and occasionally picking up a passenger for a trip.
                                    </p>
                                    <div>
                                        <p>
                                            The vehicle can be in three "phases".
                                            <ul>
                                                <li>
                                                    P1: it does not have a trip assigned, and is available. Sometimes this is called 'idle'. It is shown in blue.
                                                </li>
                                                <li>
                                                    P2: 'en route' to pick up a passenger. It is shown in an 'amber' colour.
                                                </li>
                                                <li>
                                                    P3: busy. The vehicle has a passenger
                                                </li>
                                            </ul>
                                        </p>
                                        <p>
                                            The trip origin is marked by a red diamond, and the trip destination (which shows up once the vehicle has picked up the passenger) is shown as a green circle (think of it as a target).
                                        </p>
                                        <p>
                                            When the red diamond is shown, the passenger is in a "waiting" state. When the red circle is shown, the passenger is in the vehicle.
                                        </p>
                                    </div>
                                    <div class="button-and-chart">
                                        <table>
                                            <tr>
                                                <td>
                                                    <div class="st-button-parent">
                                                        <button id="st2-button" class="app-button app-button--mini-fab">
                                                            <i class="material-icons">play_arrow</i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div id="st2-chart-parent" class="st-canvas-parent">
                                                        <canvas id="st2-chart-canvas" class="st-chart-canvas"></canvas>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <p></p>
                            <p></p>
                        </div>
                    </div>
                </div>
            </section>
            <section class="app-tab-panel" id="scroll-tab-TO" role="tabpanel" aria-labelledby="tab-TO">
                <!-- this section is the "Ridehail Toronto" tab: content has the TO or to- previx  -->
                <div id="tab-toronto" class="page-content">
                    <div class="app-grid">
                        <div id="to-grid-text-1" class="app-cell app-cell--5">
                            <h4>A starting point</h4>
                            <p>
                                First, let's see if this rough model can simulate a city like Toronto. Toronto is an area of 630km^2, modelled here as a 60*60 square city, with an average speed of 30 km/h, and each block representing one minute of travel. From p25 of
                                <a href="https://www.toronto.ca/wp-content/uploads/2021/11/98cd-VFHTransportationImpacts2021-11-23.pdf">The Transportation Impacts of Vehicle-for-Hire in Toronto: Oct 2018-July 2021</a>
                                (VFH2), on Feb 6 2020 the ridehail market in Toronto was like this:
                            </p>
                            <ul>
                                <li>
                                    194,000 trips (average 135/min)
                                </li>
                                <li>
                                    Average trip length of 8km (16 mins).
                                </li>
                                <li>
                                    Vehicle phases: 40.5% P1, 11.2% P2, 48.3% P3.
                                </li>
                                <li>
                                    Average wait time 2.1 minutes. This does not include the time between the driver "arriving" and the trip starting, so the time in this model should be a couple of minutes longer.
                                </li>
                                <li>
                                    Estimated average number of active vehicles: 6000 (eyeballing a chart).
                                </li>
                            </ul>
                            <p>
                                Using random trips, with a maximum length of 40mins (average trip length of 20 minutes), the chart shows that the simple model gets the P3 fraction right, but underestimates P2.
                            </p>
                            <p>
                                See
                                <a href="../toronto.html">this page</a>
                                for informal notes on data sources. The charts are generated by the desktop version of the model.
                            </p>
                        </div>
                        <div id="to-grid-chart-1" class="to-chart app-cell app-cell--7">
                            <img width="100%" src="./img/feb6-1.png">
                        </div>
                    </div>
                    <div class="app-grid">
                        <div id="to-grid-text-2" class="app-cell app-cell--5">
                            <h4>Many trips take place in downtown Toronto</h4>
                            <p>
                                One additional step is to introduce two "zones": a downtown zone of 30 blocks by 30 blocks, in which more trip requests are made. Here, 40% more trip requests per block come from this downtown zone than from the outside areas - all other aspects remain the same. This one additional parameter gives the right P2 values. This seems to be the simplest model of a city that reproduces the broad features of a ride hail market or system.
                            </p>
                        </div>
                        <div id="to-grid-chart-2" class="to-chart app-cell app-cell--7">
                            <img width="100%" src="./img/feb6-2.png">
                        </div>
                    </div>
                    <div class="app-grid">
                        <div id="to-grid-text-3" class="app-cell app-cell--5">
                            <h4>Supply and demand </h4>
                            <p>
                                A distinguishing feature of ridehail systems is that drivers are free to enter and leave at any time. Here, drivers will enter if they can earn more than a "reservation wage" and leave if the current pay is less. Driver earnings is the fare, minus the platform commission, multiplied by the fraction of time they are driving (P3).
                            </p>
                            <p>
                                The fare in Toronto in 2020 is about $0.18/min and $0.81/km (
                                <a href="http://taxihowmuch.com/location/toronto-on-ca">source</a>
                                ), which equates to $0.58 per minute total. In addition there is a base fare (booking fee) that does not go to the driver (see
                                <a href="https://www.cbc.ca/news/canada/toronto/uber-drivers-upfront-fares-1.3973342">this CBC article</a>
                                , and so is not included here. Uber's commission is often said to be 25%.
                            </p>
                            <p>
                                The chart at right shows that, to sustain 6000 drivers at P3=48%, drivers must have a reservation wage (before any expenses) of $0.22 per minute, which is equivalent to $13/hour. Out of this must come vehicle expenses: if those are $0.20/km (the CRA suggestion is higher, at $0.50, but drivers do drive less when waiting for a ride, so this is a guess), which is $6/hr, then drivers are ending up with an income of $7/hr.
                            </p>
                        </div>
                        <div id="to-grid-chart-3" class="to-chart app-cell app-cell--7">
                            <img width="100%" src="./img/feb6-3.png">
                        </div>
                    </div>
                    <div class="app-grid">
                        <div id="to-grid-text-4" class="app-cell app-cell--5">
                            <h4>Lowering the platform commission </h4>
                            <p>
                                If Uber decides to attract more drivers, it has several levers it can use. One is to lower its commission. What is the effect of a lower commission on driver income? It sounds like it should lead to higher incomes, but that's not what happens. Instead, the higher pay per ride attracts more drivers, so the fraction of time each driver is busy goes down until their income is the same reservation wage as before.
                            </p>
                            <p>
                                The lowered commission and consequent increase in vehicle numbers (from 6400 to 7200 in these runs) does lower wait times, but only marginally, reducing them by about 10%.
                            </p>
                        </div>
                        <div id="to-grid-chart-4" class="to-chart app-cell app-cell--7">
                            <img width="100%" src="./img/feb6-4.png">
                        </div>
                    </div>
                    <div class="app-grid">
                        <div id="to-grid-text-5" class="app-cell app-cell--5">
                            <h4>Raising the platform commission </h4>
                            <p>
                                Going the other way, if Uber decides it needs to make more money and raises the commission, the number of vehicles falls (to 5700), each vehicle is busier so that each driver makes the same hourly wage as before, and the wait time is increased, again only slightly.
                            </p>
                            <p>
                                The effect of fare and commission on demand for rides is not considered here.
                            </p>
                        </div>
                        <div id="to-grid-chart-5" class="to-chart app-cell app-cell--7">
                            <img width="100%" src="./img/feb6-5.png">
                        </div>
                    </div>
                </div>
            </section>
            <script defer type="module" src="./app.js"></script>

            <!-- Mobile: Collapsible text handler -->
            <script>
                // Simple mobile text collapse/expand
                if (window.innerWidth <= 840) {
                    const column1 = document.getElementById('column-1');
                    if (column1) {
                        column1.addEventListener('click', function() {
                            this.classList.toggle('expanded');
                        });
                    }
                }
            </script>
        </main>
    </div>

    <!-- Configuration Upload Confirmation Dialog -->
    <div id="config-confirm-dialog" class="app-dialog" hidden>
        <div class="app-dialog__overlay"></div>
        <div class="app-dialog__content">
            <h3>Load Configuration?</h3>
            <div id="config-summary" class="app-dialog__summary"></div>
            <div id="config-warnings" class="app-dialog__warnings"></div>
            <div class="app-dialog__actions">
                <button class="app-button app-button--toolbar" id="config-cancel">Cancel</button>
                <button class="app-button app-button--toolbar app-button--toolbar-primary" id="config-confirm">Load Configuration</button>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help Dialog -->
    <div id="keyboard-help-dialog" class="app-dialog" hidden>
        <div class="app-dialog__overlay"></div>
        <div class="app-dialog__content">
            <h3>Keyboard Shortcuts</h3>
            <div id="keyboard-shortcuts-list" class="keyboard-shortcuts-list"></div>
            <div class="app-dialog__actions">
                <button class="app-button app-button--toolbar app-button--toolbar-primary" id="keyboard-help-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Full-Screen Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <h1 class="loading-title">Ridehail Laboratory</h1>
            <div class="loading-spinner"></div>
            <p class="loading-message" id="loading-message">Loading the ridehail simulator...</p>
            <p class="loading-tip" id="loading-tip"></p>
        </div>
    </div>

</body>
</html>
