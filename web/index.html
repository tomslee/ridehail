<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>Ridehail Playground</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500|Material+Icons" rel="stylesheet">
    <!--  Material Design: se https://getmdl.io/started/index.html -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- theme from https://getmdl.io/customize/index.html -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.green-deep_purple.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="./d3/d3.v7.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script> -->
    <!-- rendering on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>
<body>
    <!-- Always shows a header, even in smaller screens. -->
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title"><b>Ridehail Playground (proof of concept, in development)</b><br> Simulating a ridehail system, such as Uber or Lyft. Choose your options, and press the Play button. </span>
                <!-- Add spacer, to align navigation to the right -->
                <div class="mdl-layout-spacer"></div>
                <!-- Navigation. We hide it in small screens. -->
                <nav class="mdl-navigation mdl-layout--large-screen-only">
                    <a class="mdl-navigation__link" href="https://github.com/tomslee/ridehail-animation">GitHub</a>
                    <a class="mdl-navigation__link" href="https://github.com/tomslee/ridehail-animation/blob/dev/LICENSE">License</a>
                </nav>
            </div>
            <!-- Tabs -->
            <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
                <a href="#scroll-tab-1" class="mdl-layout__tab is-active">Playground</a>
                <a href="#scroll-tab-2" class="mdl-layout__tab">Storytime</a>
            </div>
        </header>
        <main class="mdl-layout__content">
            <section class="mdl-layout__tab-panel is-active" id="scroll-tab-1">
                <div class="page-content">
                    <!-- Your content goes here -->
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col">
                            <div id="top-controls" class="top-controls">
                                <div class="timeline-controls top-control">
                                    <button class="mdl-button mdl-js-button mdl-button--icon ui-resetButton" id="reset-button" title="Reset the ridehail system" disabled>
                                        <i class="material-icons">replay</i>
                                    </button>
                                    <button id="fab-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored" title="Run/Pause" disabled>
                                        <i class="material-icons">play_arrow</i>
                                    </button>
                                    <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="next-step-button" title="Step" disabled>
                                        <i class="material-icons">skip_next</i>
                                    </button>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Frame
                                    </div>
                                    <div class="value" id="frame-count">
                                        0
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div>
                                        User Interface
                                    </div>
                                    <label for="radio-ui-mode-simple" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                        <input type="radio" id="radio-ui-mode-simple" name="ui-mode" value="simple" class="mdl-radio__button" checked>
                                        <span class="label mdl-radio__label">Simple</span>
                                    </label>
                                    <label for="radio-ui-mode-advanced" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                        <input type="radio" id="radio-ui-mode-advanced" name="ui-mode" value="advanced" class="mdl-radio__button">
                                        <span class="label mdl-radio__label">Advanced</span>
                                    </label>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Community scale
                                    </div>
                                    <div>
                                        <label for="radio-community-village" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-village" name="community" value="village" class="mdl-radio__button" checked>
                                            <span class="label mdl-radio__label">Village</span>
                                        </label>
                                        <label for="radio-community-town" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-town" name="community" value="town" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Town</span>
                                        </label>
                                        <label for="radio-community-city" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-city" name="community" value="city" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">City</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="simulation-options" class="mdl-cell mdl-cell--4-col">
                            <h5>Ridehail environment</h5>
                            <p>
                                In this model, a community is a square grid. Traffic moves at an average speed of 30km/h (for display purposes only: the model does not assume this). Each grid square is 0.5 km on each side: the size it takes a minute to cross.
                            </p>
                            <p>
                                Community area:
                                <span id="option-city-size">4</span>
                                km on each side
                                <input id="input-city-size" class="mdl-slider
                                mdl-js-slider" type="range" min="4" max="16" value="8" step="2">
                            </p>
                            <p>
                                Active ridehail vehicles:
                                <span id="option-vehicle-count">8</span>
                                <input id="input-vehicle-count" class="mdl-slider mdl-js-slider" type="range" min="1" max="16" value="8" step="1">
                            </p>
                            <p>
                                Trip requests per hour:
                                <span id="option-request-rate">30</span>
                                <input id="input-request-rate" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="2" value="0.5" step="0.1">
                            </p>
                        </div>
                        <div id="display-options" class="mdl-cell mdl-cell--4-col">
                            <h5>Display options</h5>
                            Control the way that the output is displayed.
                            <p>
                                Chart type:
                                <span id="option-chart-type">Map</span>
                                <form>
                                    <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-map">
                                        <input type="radio" id="option-map" class="mdl-radio__button" name="options" value="Map" checked>
                                        <span class="mdl-radio__label">Map</span>
                                    </label>
                                    <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-stats">
                                        <input type="radio" id="option-stats" class="mdl-radio__button" name="options" value="Stats">
                                        <span class="mdl-radio__label">Stats</span>
                                    </label>
                                </form>
                            </p>
                            <p>
                                Plot smoothing (stats plot only): show rolling average over
                                <span id="option-smoothing-window">20</span>
                                minutes
                                <input id="input-smoothing-window" class="mdl-slider mdl-js-slider" type="range" min="1" max="32" value="20" step="1">
                            </p>
                            <p>
                                Plot display maximum frame rate:
                                <span id="option-frame-timeout">300</span>
                                milliseconds
                                <input id="input-frame-timeout" class="mdl-slider mdl-js-slider" type="range" min="0" max="1000" value="300" step="10">
                            </p>
                            <!--  MDL spinner -->
                            <div id="spinner" class="mdl-spinner mdl-js-spinner is-active"></div>
                        </div>
                        <div class="mdl-cell mdl-cell--4-col">
                            <div id="pg-canvas-parent" class="pg-canvas-parent">
                                <canvas id="pg-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mdl-layout__tab-panel" id="scroll-tab-2">
                <div class="page-content">
                    <div class="mdl-grid">
                        <div id="st1-grid" class="mdl-cell mdl-cell--6-col-desktop mdl-cell--3-offset-desktop" margin:auto="">
                            <h4>Ridehailing</h4>
                            <p>
                                Start with a community, which is a square grid with a number of "blocks" on each side.
                            </p>
                            <p>
                                A vehicle drives randomly around the community. If it goes off one edge, it appears on the opposite edge. This turns out to be a useful simplification. You can also think of it as some vehicles leaving the area, and others entering.
                            </p>
                            <div class="button-and-chart">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="st-button-parent">
                                                <button id="st1-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                                    <i class="material-icons">play_arrow</i>
                                                </button>
                                            </div>
                                        </td>
                                        <td>
                                            <div id="st1-chart-parent" class="st-canvas-parent">
                                                <canvas id="st1-chart-canvas" class="st-chart-canvas"></canvas>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div>
                                <p>
                                    In addition to vehicles, we need trips. Here is a vehicle driving around, and occasionally picking up a passenger for a trip.
                                </p>
                                <div>
                                    <p>
                                        The vehicle can be in three "phases".
                                        <ul>
                                            <li>
                                                P1: it does not have a trip assigned, and is available. Sometimes this is called 'idle'. It is shown in blue.
                                            </li>
                                            <li>
                                                P2: 'en route' to pick up a passenger. It is shown in an 'amber' colour.
                                            </li>
                                            <li>
                                                P3: busy. The vehicle has a passenger
                                            </li>
                                        </ul>
                                    </p>
                                    <p>
                                        The trip origin is marked by a red diamond, and the trip destination (which shows up once the vehicle has picked up the passenger) is shown as a red circle (think of it as a target).
                                    </p>
                                    <p>
                                        When the red diamond is shown, the passenger is in a "waiting" state. When the red circle is shown, the passenger is in the vehicle.
                                    </p>
                                </div>
                                <div class="button-and-chart">
                                    <table>
                                        <tr>
                                            <td>
                                                <div class="st-button-parent">
                                                    <button id="st2-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                                        <i class="material-icons">play_arrow</i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td>
                                                <div id="st2-chart-parent" class="st-canvas-parent">
                                                    <canvas id="st2-chart-canvas" class="st-chart-canvas"></canvas>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <h4>The ridehailing model</h4>
                                <p>
                                    The model is written in python and was inspired in part by this
                                    <a href="https://www.nytimes.com/interactive/2017/04/02/technology/uber-drivers-psychological-tricks.html">2017 New York Times interactive visualization</a>
                                    (scroll down that page a bit). It runs in the browser using the amazing
                                    <a href="https://pyodide.org">Pyodide</a>
                                    distribution, although you can also run it on a Linux or Windows desktop if you are OK with setting up and running python packages.. It should run on a Mac too, but I have not verified that. The UI is built with
                                    <a href="https://getmdl.io/started/index.html">Material Design Lite,</a>
                                    and the page construction takes inspiration from the impressive
                                    <a href="https://playground.tensorflow.org/">TensorFlow Playground.</a>
                                    Remaining screw-ups are mine.
                                </p>
                                <p>
                                    Source code is available from
                                    <a href="https://github.com/tomslee/ridehail-animation">GitHub.</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <script defer type="module" src="./main.js"></script>
</body>
</html>
