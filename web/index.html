<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>Ridehail Playground</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500|Material+Icons" rel="stylesheet">
    <!--  Material Design: se https://getmdl.io/started/index.html -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- theme from https://getmdl.io/customize/index.html -->
    <!--
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.green-deep_purple.min.css">
    -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-deep_orange.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="./d3/d3.v7.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script> -->
    <!-- rendering on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>
<body>
    <!-- Always shows a header, even in smaller screens. -->
    <div class="mdl-layout mdl-js-layout">
        <header class="mdl-layout__header  mdl-layout__header--scroll">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title">A Ridehail Simulation</span>
                <!-- Add spacer, to align navigation to the right -->
                <div class="mdl-layout-spacer"></div>
                <!-- Navigation. We hide it in small screens. -->
                <nav class="mdl-navigation mdl-layout--large-screen-only">
                    <a class="mdl-navigation__link" href="https://github.com/tomslee/ridehail-animation">GitHub</a>
                    <a class="mdl-navigation__link" href="https://github.com/tomslee/ridehail-animation/blob/dev/LICENSE">License</a>
                </nav>
            </div>
            <!-- Tabs -->
            <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
                <a href="#scroll-tab-1" class="mdl-layout__tab is-active">Playground</a>
                <a href="#scroll-tab-2" class="mdl-layout__tab">About</a>
            </div>
        </header>
        <main class="mdl-layout__content">
            <section class="mdl-layout__tab-panel is-active" id="scroll-tab-1">
                <div class="page-content">
                    <!-- Your content goes here -->
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--12-col">
                            <div id="top-controls" class="top-controls">
                                <div class="timeline-controls top-control">
                                    <button class="mdl-button mdl-js-button mdl-button--icon ui-resetButton" id="reset-button" title="Reset the ridehail system" disabled>
                                        <i class="material-icons">replay</i>
                                    </button>
                                    <button id="fab-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored" title="Run/Pause" disabled>
                                        <i class="material-icons">play_arrow</i>
                                    </button>
                                    <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="next-step-button" title="Step" disabled>
                                        <i class="material-icons">skip_next</i>
                                    </button>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Frame
                                    </div>
                                    <div class="value" id="frame-count">
                                        0
                                    </div>
                                </div>
                                <div id="top-control-spinner" class="top-control">
                                    <!--  MDL spinner -->
                                    <div id="spinner" class="mdl-spinner mdl-js-spinner is-active"></div>
                                    <p>
                                        Loading the ridehail simulator...
                                    </p>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Community scale
                                    </div>
                                    <div>
                                        <label for="radio-community-village" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-village" name="community" value="village" class="mdl-radio__button" checked>
                                            <span class="label mdl-radio__label">Village</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-community-town" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-town" name="community" value="town" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Town</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-community-city" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-community-city" name="community" value="city" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">City</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div>
                                        Chart type
                                    </div>
                                    <div>
                                        <label for="radio-chart-type-map" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-chart-type-map" class="mdl-radio__button" name="chart-type" value="map" checked>
                                            <span class="mdl-radio__label">Map</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-chart-type-stats" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-chart-type-stats" class="mdl-radio__button" name="chart-type" value="stats">
                                            <span class="mdl-radio__label">Statistics</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="top-control">
                                    <div>
                                        User Interface
                                    </div>
                                    <div>
                                        <label for="radio-ui-mode-simple" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-ui-mode-simple" name="ui-mode" value="simple" class="mdl-radio__button" checked>
                                            <span class="label mdl-radio__label">Simple</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="radio-ui-mode-advanced" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-ui-mode-advanced" name="ui-mode" value="advanced" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Advanced</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <!-- end of top-controls -->
                        </div>
                        <!-- end of 12-column grid box-->
                        <div id="display-options" class="mdl-cell mdl-cell--5-col">
                            <div class="ui-mode-simple">
                                <h5>Getting started</h5>
                                <p>
                                    Once the simulator has loaded, click the big button to start a simulation. The map shows a model city (a square of blocks) with ridehail vehicles driving around waiting for a trip (the triangles). Drivers respond to trip requests (red diamonds) and carry the passengers to their destination (red circles). Click
                                    <b>Statistics</b>
                                    above to show wait times, how driver time is split between different activities, and driver income. For more information, click
                                    <b>About</b>
                                    in the coloured title bar (under construction).
                                </p>
                            </div>
                            <h5>Time, distance, and money</h5>
                            <div>
                                <div class="ui-mode-simple">
                                    <p>
                                        For Simple mode, here are the settings:
                                        <ul>
                                            <li>
                                                The fare is $0.25/minute + $0.50/km. At an average speed of 30km/h (including stops), this is equivalent to $1.25 per block.
                                            </li>
                                            <li>
                                                The platform takes a 25% commission
                                            </li>
                                            <li>
                                                Drivers earn money only when they have a passenger in the car
                                            </li>
                                            <li>
                                                Vehicle operating costs are estimated at $0.55/km, which is the lower end of the
                                                <a href="https://www.canada.ca/en/revenue-agency/services/tax/businesses/topics/payroll/benefits-allowances/automobile/automobile-motor-vehicle-allowances/reasonable-kilometre-allowance.html">Revenue Canada "reasonable allowance rates"</a>
                                                for reimbursement of employee use of a vehicle for business purposes. This amount is then halved, to estimate the effect of drivers covering less distance when waiting for a call.
                                            </li>
                                            <li>
                                                If you check "Vehicles enter and leave" then driver gross income (before any expenses) must be $0.35 per block ($21/hour) to be worth driving. This is the "reserve wage".
                                            </li>
                                        </ul>
                                    </p>
                                </div>
                            </div>
                            <div class="ui-mode-advanced" style="display:none">
                                <!--
                                <div class="ui-ridehail-settings ui-mode-advanced">
                                    <div>
                                        City scale unit
                                    </div>
                                    <div>
                                        <label for="radio-city-scale-unit-block" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-city-scale-unit-block" name="city-scale-unit" value="block" class="mdl-radio__button" checked>
                                            <span class="label mdl-radio__label">Blocks</span>
                                        </label>
                                        <label for="radio-city-scale-unit-km" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-city-scale-unit-km" name="city-scale-unit" value="km" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Kilometers</span>
                                        </label>
                                        <label for="radio-city-scale-unit-min" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                                            <input type="radio" id="radio-city-scale-unit-min" name="city-scale-unit" value="min" class="mdl-radio__button">
                                            <span class="label mdl-radio__label">Minutes</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="ui-ridehail-settings ui-mode-advanced">
                                    <label for="input-blocks-per-unit">
                                        Blocks per unit
                                        <span class="value" id="option-blocks-per-unit">1</span>
                                    </label>
                                    <input id="input-blocks-per-unit" class="mdl-slider
                                mdl-js-slider" type="range" min="0.5" max="2" value="1" step="0.5">
                                </div>
                                -->
                                <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                    <label for="input-mean-vehicle-speed">
                                        Mean vehicle speed:
                                        <span class="value" id="option-mean-vehicle-speed">30</span>
                                        km/h
                                    </label>
                                    <p>
                                        This speed is an average including all stops and pickups
                                    </p>
                                    <input id="input-mean-vehicle-speed" class="mdl-slider
                                mdl-js-slider" type="range" min="10" max="50" value="30" step="5">
                                </div>
                                <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                    <label for="input-per-km-price">
                                        Fare per km: $
                                        <span class="value" id="option-per-km-price">0.80</span>
                                    </label>
                                    <p>
                                        The distance component of the fare. The total fare is built from distance and time components
                                    </p>
                                    <input id="input-per-km-price" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1.20" value="0.80" step="0.1">
                                </div>
                                <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                    <label for="input-per-min-price">
                                        Fare per minute: $
                                        <span class="value" id="option-per-min-price">0.40</span>
                                    </label>
                                    <p>
                                        The distance component of the fare. The total fare is built from distance and time components
                                    </p>
                                    <input id="input-per-min-price" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="0.60" value="0.40" step="0.05">
                                </div>
                                <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                    <label for="input-platform-commission">
                                        Platform commission:
                                        <span class="value" id="option-platform-commission">0.25</span>
                                    </label>
                                    <p>
                                        The fraction of the fare that the ridehailing platform takes. It passes the rest to the driver.
                                    </p>
                                    <input id="input-platform-commission" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="0.5" value="0.25" step="0.01">
                                </div>
                                <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                    <label for="input-per-km-ops-cost">
                                        Vehicle operations cost per km: $
                                        <span class="value" id="option-per-km-ops-cost">0.25</span>
                                    </label>
                                    <p>
                                        The cost to the driver of running their vehicle, per kilometer
                                    </p>
                                    <input id="input-per-km-ops-cost" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1" value="0.25" step="0.05">
                                </div>
                                <div class="ui-ridehail-settings ui-mode-advanced ui-mode-reset">
                                    <label for="input-per-unit-opp-cost">
                                        Vehicle opportunity cost per hour: $
                                        <span class="value" id="option-per-unit-opp-cost">10</span>
                                    </label>
                                    <p>
                                        If you choose "Vehicles enter and leave" then vehicles will enter if they can make at least this amount of money (after all deductions), and leave if they cannot
                                    </p>
                                    <input id="input-per-unit-opp-cost" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="30" value="10" step="1">
                                </div>
                            </div>
                        </div>
                        <div id="simulation-options" class="mdl-cell mdl-cell--3-col">
                            <h5>Ridehail environment</h5>
                            <div class="ui-ridehail-settings ui-mode-reset">
                                <label for="input-city-size">
                                    Community area:
                                    <span class="value" id="option-city-size">8</span>
                                    blocks on each side
                                </label>
                                <p>
                                    Each block is the distance a vehicle drives in one minute.
                                </p>
                                <input id="input-city-size" class="mdl-slider
                                mdl-js-slider" type="range" min="4" max="16" value="8" step="2">
                            </div>
                            <div class="ui-ridehail-settings">
                                <label for="input-vehicle-count">
                                    Ridehail vehicles:
                                    <span class="value" id="option-vehicle-count">8</span>
                                </label>
                                <p>
                                    The total number of ridehail vehicles in the area. If you check "Vehicles enter and leave" the number will change during the simulation.
                                </p>
                                <input id="input-vehicle-count" class="mdl-slider mdl-js-slider" type="range" min="1" max="16" value="8" step="1">
                            </div>
                            <div class="ui-ridehail-settings">
                                <label class="mld-inputfield__label" for="input-request-rate">
                                    Trip requests per hour:
                                    <span class="value" id="option-request-rate">30</span>
                                </label>
                                <p>
                                    A rate of 60/hr means that one trip is requested in the time it takes vehicles to travel one block
                                </p>
                                <p>
                                    <input id="input-request-rate" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="2" value="0.5" step="0.1">
                                </p>
                            </div>
                            <div class="ui-ridehail-settings ui-mode-advanced">
                                <label class="mld-inputfield__label" for="input-two-zone">
                                    Two zones: how much should the central zone be favoured?
                                    <span class="value" id="option-two-zone">0</span>
                                </label>
                                <p>
                                    When zero, trips start evenly across the area. When set to 1, all trips start in a central zone. Trips always terminate evenly across the area.
                                </p>
                                <input id="input-two-zone" class="mdl-slider
                                mdl-js-slider" type="range" min="0" max="1" value="0.0" step="0.1">
                            </div>
                            <div class="ui-ridehail-settings">
                                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-equilibrate">
                                    <input type="checkbox" id="checkbox-equilibrate" class="mdl-checkbox__input">
                                    <span class="mdl-checkbox__label">Vehicles enter and leave</span>
                                </label>
                                <p>
                                    Vehicles enter when there is money to be made above the "reserve wage", and leave when they cannot make money.
                                </p>
                            </div>
                            <h5>Display</h5>
                            <div class="ui-ridehail-settings ui-money-options ui-mode-reset">
                                Statistics chart smoothing
                                <span id="option-smoothing-window">20</span>
                                frames
                                <p>
                                    Statistics charts display a rolling average over this number of frames
                                </p>
                                <input id="input-smoothing-window" class="mdl-slider mdl-js-slider" type="range" min="1" max="32" value="20" step="1">
                            </div>
                            <div class="ui-ridehail-settings ui-display-options">
                                Chart display maximum frame rate:
                                <span id="option-frame-timeout">300</span>
                                milliseconds
                                <p>
                                    A small time speeds up the simulation.
                                </p>
                                <input id="input-frame-timeout" class="mdl-slider mdl-js-slider" type="range" min="0" max="1000" value="300" step="10">
                            </div>
                        </div>
                        <div id="chart-column" class="mdl-cell mdl-cell--4-col">
                            <div id="pg-canvas-parent" class="pg-canvas-parent">
                                <canvas id="pg-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div id="pg-driver-canvas-parent" class="pg-canvas-parent">
                                <canvas id="pg-driver-chart-canvas" class="pg-chart-canvas"></canvas>
                            </div>
                            <div id="pg-stats-descriptions" class="pg-stats-descriptions" style="display:none">
                                <p>
                                    Driver earnings key:
                                    <ul>
                                        <li>
                                            On-the-clock: hourly pay rate while drivers have a passenger in the car. The price rate the customer pays, minus the platform commission.
                                        </li>
                                        <li>
                                            Gross: actual hourly pay before any expenses. The "on-the-clock" pay, adjusted for the proportion of the time the driver has a passenger ("P3" time).
                                        </li>
                                        <li>
                                            Net: hourly pay after operating expenses.
                                        </li>
                                    </ul>
                                </p>
                            </div>
                            <div id="pg-text-status" hidden>
                                <ul>
                                    <li>
                                        Vehicle count:
                                        <span id="text-status-vehicle-count"></span>
                                    </li>
                                    <li>
                                        Total price: $
                                        <span id="text-status-price"></span>
                                        / minute
                                    </li>
                                    <li>
                                        Platform commission:
                                        <span id="text-status-platform-commission"></span>
                                        %
                                    </li>
                                    <li>
                                        Driver gross hourly income: $
                                        <span id="text-status-driver-income"></span>
                                        / hour
                                    </li>
                                    <li>
                                        Reserve wage: $
                                        <span id="text-status-reserved-wage"></span>
                                        / hour
                                    </li>
                                    <li>
                                        Average wait time:
                                        <span id="text-status-wait-time"></span>
                                        minutes
                                    </li>
                                    <li class="ui-mode-advanced">
                                        Fare per km:
                                        <span id="text-status-per-km-price"></span>
                                    </li>
                                    <li class="ui-mode-advanced">
                                        Fare per min:
                                        <span id="text-status-per-min-price"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mdl-layout__tab-panel" id="scroll-tab-2">
                <div class="page-content">
                    <div class="mdl-grid">
                        <div id="st1-grid" class="mdl-cell mdl-cell--6-col-desktop mdl-cell--3-offset-desktop" margin:auto="">
                            <h4>The ridehailing simulation model</h4>
                            <p>
                                The model is a work in progress. It is written in python and source code is available from
                                <a href="https://github.com/tomslee/ridehail-animation">GitHub.</a>
                            </p>
                            <h4>Contact</h4>
                            <p>
                                Email:
                                <a href="mailto:tom@tomslee.net?subject=Ridehail simulation">tom@tomslee.net</a>
                            </p>
                            <h4>Acknowledgements</h4>
                            <p>
                                The project was inspired in part by this
                                <a href="https://www.nytimes.com/interactive/2017/04/02/technology/uber-drivers-psychological-tricks.html">2017 New York Times interactive visualization</a>
                                (scroll down that page a bit).
                            </p>
                            <p>
                                The calculations run in the browser using the amazing
                                <a href="https://pyodide.org">Pyodide</a>
                                distribution, although you can also run it on a Linux or Windows desktop if you are OK with setting up and running python packages. It should run on a Mac too, but I have not verified that.
                            </p>
                            <p>
                                The site design is inspired by the impressive
                                <a href="https://playground.tensorflow.org/">TensorFlow Playground,</a>
                                and, like that site, uses
                                <a href="https://getmdl.io/started/index.html">Material Design Lite</a>
                                for components and layout.
                            </p>
                            <p>
                                Thanks also to Thorben and JJ from
                                <a href="https://ridefair.ca/">The RideFairTO Coalition,</a>
                                for encouragement, conversations, guidance, and contacts.
                            </p>
                            <p>
                                Errors and other flaws are all mine.
                            </p>
                            <div style="display:none">
                                <h4>Ridehailing</h4>
                                <p>
                                    Start with a community, which is a square grid with a number of "blocks" on each side.
                                </p>
                                <p>
                                    A vehicle drives randomly around the community. If it goes off one edge, it appears on the opposite edge. This turns out to be a useful simplification. You can also think of it as some vehicles leaving the area, and others entering.
                                </p>
                                <div class="button-and-chart">
                                    <table>
                                        <tr>
                                            <td>
                                                <div class="st-button-parent">
                                                    <button id="st1-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                                        <i class="material-icons">play_arrow</i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td>
                                                <div id="st1-chart-parent" class="st-canvas-parent">
                                                    <canvas id="st1-chart-canvas" class="st-chart-canvas"></canvas>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div>
                                    <p>
                                        In addition to vehicles, we need trips. Here is a vehicle driving around, and occasionally picking up a passenger for a trip.
                                    </p>
                                    <div>
                                        <p>
                                            The vehicle can be in three "phases".
                                            <ul>
                                                <li>
                                                    P1: it does not have a trip assigned, and is available. Sometimes this is called 'idle'. It is shown in blue.
                                                </li>
                                                <li>
                                                    P2: 'en route' to pick up a passenger. It is shown in an 'amber' colour.
                                                </li>
                                                <li>
                                                    P3: busy. The vehicle has a passenger
                                                </li>
                                            </ul>
                                        </p>
                                        <p>
                                            The trip origin is marked by a red diamond, and the trip destination (which shows up once the vehicle has picked up the passenger) is shown as a red circle (think of it as a target).
                                        </p>
                                        <p>
                                            When the red diamond is shown, the passenger is in a "waiting" state. When the red circle is shown, the passenger is in the vehicle.
                                        </p>
                                    </div>
                                    <div class="button-and-chart">
                                        <table>
                                            <tr>
                                                <td>
                                                    <div class="st-button-parent">
                                                        <button id="st2-button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                                            <i class="material-icons">play_arrow</i>
                                                        </button>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div id="st2-chart-parent" class="st-canvas-parent">
                                                        <canvas id="st2-chart-canvas" class="st-chart-canvas"></canvas>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <p></p>
                        </div>
                    </div>
                </div>
            </section>
            <script defer type="module" src="./main.js"></script>
        </main>
    </div>
</body>
</html>
